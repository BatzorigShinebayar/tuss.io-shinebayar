<template>  <div>    <div class="row">      <div class="col-lg-3 d-flex align-items-center">        <div>          <b-badge variant="primary">{{ stage.code }}</b-badge>          <p>{{ stage.name }}</p>        </div>      </div>      <div class="col-lg-9">        <div class="w-100">          <vue-slider            v-model="value"            ref="slider"            class="stage-group-slider"            :data="sliderData"            :data-value="'value'"            :data-label="'label'"            :hide-label="true"            @change="action"            tooltip="none"            :order="false"          >          </vue-slider>          <div class="d-flex justify-content-between">            <p>{{ startLabel }}</p>            <p>{{ endLabel }}</p>          </div>          <div class="row mt-3">            <div              :class="                stage.can_repeat && canRepeat && tussRepeat                  ? 'col-lg-9'                  : 'col-lg-12'              "            >              <b-form-group                label="Assigned employee"                label-for="input-sm"                class="mb-2"              >                <treeselect                  id="task-create-assigned-employee"                  v-model="assignedEmployee"                  :multiple="false"                  :options="selectedEmployee"                  :clearable="false"                  :normalizer="normalizer"                  track-by="id"                  @input="action"                >                </treeselect>              </b-form-group>            </div>            <div              class="col-lg-3"              v-if="stage.can_repeat && canRepeat && tussRepeat"            >              <b-form-group label="Repeated?">                <b-form-checkbox                  v-model="isRepeat"                  name="can-repeat"                  class="tus-check-btn"                  @change="changeVal"                >                  {{ isRepeat ? 'Yes' : 'No' }}                </b-form-checkbox>              </b-form-group>            </div>          </div>        </div>      </div>    </div>    <hr />  </div></template><script>import VueSlider from 'vue-slider-component';import Treeselect from '@riophae/vue-treeselect';export default {  name: 'TaskStageSlider',  components: {    VueSlider,    Treeselect,  },  props: {    executor: {      type: Number,      default() {        return null;      },    },    team: {      type: Array,      default() {        return null;      },    },    sliderValue: {      type: Array,      default() {        return null;      },    },    defaultValue: {      type: Array,      default() {        return null;      },    },    stage: {      type: Object,      default() {        return null;      },    },    canRepeat: {      type: Boolean,      default() {        return false;      },    },    tussRepeat: {      type: Boolean,      default() {        return false;      },    },    algId: {      type: Number,      default() {        return null;      },    },  },  data() {    return {      value: [null, null],      minDate: null,      maxDate: null,      dayCount: null,      dateList: null,      normalizer(node) {        return {          id: node.partner__id,          label: `${node.partner__name} ${node.partner__last_name} /${node.department__short_name}/`,        };      },      assignedEmployee: null,      startLabel: null,      endLabel: null,      stageDateNull: true,      sliderData: this.sliderValue,      isRepeat: false,    };  },  computed: {    selectedEmployee() {      const employeeList = this.updateEmployeeList();      this.setDefault();      return employeeList;    },  },  watch: {    executor() {      this.assignedEmployee = [this.executor];      this.updateEmployeeList();    },    team() {      this.updateEmployeeList();    },    sliderValue(data) {      if (!this.tussRepeat) {        this.sliderData = data;      } else {        if (!this.stage.can_repeat) {          this.sliderData = this.defaultValue;        } else {          this.sliderData = data;        }      }      this.updateSliderLabel();      this.action();    },    isRepeat(data) {      if (this.tussRepeat) {        if (!data) {          this.sliderData = this.defaultValue;        } else {          this.sliderData = this.sliderValue;        }        this.updateSliderLabel();        this.action();      }    },    tussRepeat(data) {      if (data && !this.stage.can_repeat) {        this.isRepeat = false;      }    },  },  mounted() {    if (this.canRepeat) {      this.isRepeat = true;    }    if (this.tussRepeat && !this.stage.can_repeat) {      this.isRepeat = false;    }    this.sliderValue.push('');    this.sliderValue.pop();    // this.action();    // this.updateSliderLabel();  },  methods: {    changeVal(val) {      this.isRepeat = val;    },    action() {      let currentStartDate;      let currentEndDate;      if (this.value[0] > this.value[1]) {        currentStartDate = this.value[1];        currentEndDate = this.value[0];      } else {        currentStartDate = this.value[0];        currentEndDate = this.value[1];      }      for (const val of this.sliderData) {        if (currentStartDate === val.value) {          this.startLabel = val.label;        }        if (currentEndDate === val.value) {          this.endLabel = val.label;        }      }      const objType =        !!this.assignedEmployee && this.assignedEmployee.constructor === Array;      if (objType) {        this.assignedEmployee = this.assignedEmployee[0];      }      let start = this.value[0];      let end = this.value[1];      if (!start || !end) {        const startDefault = this.sliderData[0];        const endDefault = this.sliderData[this.sliderData.length - 1];        start = startDefault.value;        end = endDefault.value;      }      const context = {        id: this.stage.id,        employee: this.assignedEmployee,        is_repeated: this.isRepeat,        start: start,        end: end,      };      this.$emit('slider', context);    },    updateEmployeeList() {      const selectedEmployeeList = [];      if (this.team) {        for (const member of this.team) {          selectedEmployeeList.push(member);        }        if (!this.team.includes(this.executor)) {          selectedEmployeeList.push(this.executor);        }      } else {        selectedEmployeeList.push(this.executor);      }      const allEmployee = this.$store.getters.company.employees;      const chosenEmployees = [];      if (selectedEmployeeList) {        for (const oneEmp of selectedEmployeeList) {          for (const emps of allEmployee) {            if (oneEmp === emps.partner__id) {              chosenEmployees.push(emps);            }          }        }      }      return chosenEmployees;    },    setDefault() {      this.assignedEmployee = [this.executor];    },    updateSliderLabel() {      const last = this.sliderData.length - 1;      const start = this.sliderData[0];      const end = this.sliderData[last];      this.value = [];      this.value.push(start.value);      this.value.push(end.value);      this.startLabel = start.label;      this.endLabel = end.label;    },  },};</script>