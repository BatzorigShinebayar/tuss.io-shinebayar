<template>  <div>    <b-form-group label="Task frequency">      <b-form-radio-group        v-model="taskFrequencySelected"        :options="taskFrequency"        class="tus-radio-btn"        @change="changeFrequency"      >      </b-form-radio-group>      <p        v-if="!$v.taskFrequencySelected.required && formSubmit"        class="text-danger mb-4"      >        Frequency is required      </p>    </b-form-group>    <div v-if="taskFrequencySelected === 'one_time'">      <div class="row">        <div class="col-lg-4">          <b-form-group label="Start date">            <b-form-datepicker              v-model="taskStartDate"              today-button              close-button              placeholder="MM-DD-YYYY"              :date-format-options="dateFormat"              :state="dateError"              @input="changeOneTime"            ></b-form-datepicker>          </b-form-group>        </div>        <div class="col-lg-4">          <b-form-group label="End date">            <b-form-datepicker              v-model="taskEndDate"              today-button              close-button              placeholder="MM-DD-YYYY"              :date-format-options="dateFormat"              :state="dateError"              @input="changeOneTime"            ></b-form-datepicker>          </b-form-group>        </div>        <div v-if="dateError" class="col-lg-4">          <p class="mb-3">Duration</p>          <p>{{ taskDuration }} days</p>        </div>      </div>      <p v-if="!dateError" class="text-danger mb-4">        Start date, end date wrong      </p>    </div>    <div v-else class="row">      <div class="col-lg-4">        <b-form-group label="Start date">          <b-form-datepicker            v-model="taskStartDate"            today-button            close-button            placeholder="MM-DD-YYYY"            :date-format-options="dateFormat"            @input="changeRepeatedTime"          ></b-form-datepicker>        </b-form-group>      </div>      <div class="col-lg-4">        <b-form-group :label="label">          <b-form-input            v-model="value"            type="number"            :min="min"            :max="max"            @input="changeRepeatedTime"          ></b-form-input>        </b-form-group>      </div>      <div v-if="taskEndDate" class="col-lg-4">        <p class="mb-3">End date</p>        <p>{{ taskEndDate }}</p>      </div>    </div>  </div></template><script>import { required } from 'vuelidate/lib/validators';export default {  name: 'TaskFrequency',  props: {    formSubmit: Boolean,    defaultValue: {      type: Object,      default() {        return null;      },    },  },  computed: {    today() {      return new Date().toISOString().slice(0, 10);    },  },  data() {    return {      taskFrequencySelected: 'one_time',      taskFrequency: [        { value: 'one_time', text: 'One-time' },        { value: 'weekly', text: 'Weekly' },        { value: 'monthly', text: 'Monthly' },        { value: 'quarterly', text: 'Quarterly' },        { value: 'half_year', text: 'Bi-annual' },        { value: 'yearly', text: 'Annually' },      ],      dateFormat: {        year: 'numeric',        month: '2-digit',        day: '2-digit',      },      taskStartDate: null,      taskEndDate: null,      taskDuration: null,      value: '1',      dateError: false,      label: null,      min: '1',      max: null,    };  },  watch: {    defaultValue() {      this.loadDefault();    },  },  validations: {    taskFrequencySelected: { required },  },  mounted() {    this.loadDefault();  },  methods: {    loadDefault() {      if (this.defaultValue) {        this.taskFrequencySelected = this.defaultValue.frequency;        this.taskStartDate = this.defaultValue.startDate;        this.taskEndDate = this.defaultValue.endDate;        this.value = String(this.defaultValue.repeat);      } else {        this.changeFrequency();      }    },    changeFrequency() {      this.value = '1';      if (this.taskFrequencySelected === 'one_time') {        this.setDefaultOneTime();      } else if (this.taskFrequencySelected === 'weekly') {        this.setDefaultWeekly();      } else if (this.taskFrequencySelected === 'monthly') {        this.setDefaultMontly();      } else if (this.taskFrequencySelected === 'quarterly') {        this.setDefaultQuarterly();      } else if (this.taskFrequencySelected === 'half_year') {        this.setDefaultBiAnnual();      } else if (this.taskFrequencySelected === 'yearly') {        this.setDefaultAnnual();      }    },    setDefaultOneTime() {      const epoch = 1000 * 60 * 60 * 24 * 7;      const startDate = new Date(this.today);      const epochDate = startDate.getTime() + epoch;      const endDate = new Date(epochDate);      this.taskStartDate = startDate.toISOString().slice(0, 10);      this.taskEndDate = endDate.toISOString().slice(0, 10);      const durationEpoch = endDate - startDate;      const durationDays = Math.ceil(durationEpoch / (1000 * 60 * 60 * 24));      this.taskDuration = durationDays + 1;      this.value = durationDays + 1;      this.dateError = endDate >= startDate;      this.send();    },    setDefaultWeekly() {      this.max = 53;      this.label = 'Duration /weekly/';      const startDate = new Date(this.today);      const epoch = this.value * (1000 * 60 * 60 * 24 * 7);      const epochEndDate = startDate.getTime() + epoch;      const endDate = new Date(epochEndDate);      this.taskEndDate = endDate.toISOString().slice(0, 10);      this.send();    },    setDefaultMontly() {      this.max = 36;      this.label = 'Duration /monthly/';      const startDate = new Date(this.today);      const newDate = new Date(        startDate.setMonth(startDate.getMonth() + parseInt(this.value))      );      this.taskEndDate = newDate.toISOString().slice(0, 10);      this.send();    },    setDefaultQuarterly() {      this.max = 12;      this.label = 'Duration /quarterly/';      const startDate = new Date(this.today);      const newDate = new Date(        startDate.setMonth(startDate.getMonth() + this.value * 3)      );      this.taskEndDate = newDate.toISOString().slice(0, 10);      this.send();    },    setDefaultBiAnnual() {      this.max = 6;      this.label = 'Duration /bi-annual/';      const startDate = new Date(this.today);      const newDate = new Date(        startDate.setMonth(startDate.getMonth() + parseInt(this.value) * 6)      );      this.taskEndDate = newDate.toISOString().slice(0, 10);      this.send();    },    setDefaultAnnual() {      this.max = 3;      this.label = 'Duration /annual/';      const startDate = new Date(this.today);      const year = startDate.getFullYear();      const month = startDate.getMonth();      const day = startDate.getDate();      const newDate = new Date(year + parseInt(this.value), month, day);      this.taskEndDate = newDate.toISOString().slice(0, 10);      this.send();    },    changeOneTime() {      const startDate = new Date(this.taskStartDate);      const endDate = new Date(this.taskEndDate);      const durationEpoch = endDate - startDate;      const durationDays = Math.ceil(durationEpoch / (1000 * 60 * 60 * 24));      this.taskDuration = durationDays + 1;      this.value = durationDays + 1;      if (startDate <= endDate) {        this.dateError = true;        this.send();      } else {        this.dateError = false;      }    },    changeRepeatedTime() {      let endDate;      const startDate = new Date(this.taskStartDate);      if (this.taskFrequencySelected === 'weekly') {        const epoch = this.value * (1000 * 60 * 60 * 24 * 7);        const epochEndDate = startDate.getTime() + epoch;        endDate = new Date(epochEndDate);      } else if (this.taskFrequencySelected === 'monthly') {        endDate = new Date(          startDate.setMonth(startDate.getMonth() + parseInt(this.value))        );      } else if (this.taskFrequencySelected === 'quarterly') {        endDate = new Date(          startDate.setMonth(startDate.getMonth() + this.value * 3)        );      } else if (this.taskFrequencySelected === 'half_year') {        endDate = new Date(          startDate.setMonth(startDate.getMonth() + parseInt(this.value) * 6)        );      } else if (this.taskFrequencySelected === 'yearly') {        const year = startDate.getFullYear();        const month = startDate.getMonth();        const day = startDate.getDate();        endDate = new Date(year + parseInt(this.value), month, day);      }      this.taskEndDate = endDate.toISOString().slice(0, 10);      this.send();    },    send() {      if (this.taskStartDate && this.taskEndDate) {        const taskDate = {          frequency: this.taskFrequencySelected,          startDate: this.taskStartDate,          endDate: this.taskEndDate,          repeat: parseInt(this.value),        };        this.$emit('getFrequency', taskDate);      }    },  },};</script>