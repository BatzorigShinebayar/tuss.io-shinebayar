<template>  <div>    <b-table striped hover :fields="tableFields" :items="tableDatas">      <template #cell(sequence)="props">        {{ props.index + 1 }}      </template>      <template #cell(dropdown)="props">        <i          :id="props"          class="dropdown bx bxs-chevron-down-circle task-detail-icon"          :class="{ active: props.detailsShowing === true }"          @click="toggleDetails(props)"        ></i>      </template>      <template #cell(affects_salary)="props">        <p v-if="props.item.affects_salary" class="text-danger">Yes</p>        <p v-else class="text-success">No</p>      </template>      <template #cell(ach_score)="props">        <p :class="check(props.item.ach_score)">          {{ props.item.ach_score }}        </p>      </template>      <template #cell(type)="props">        <p>          {{ props.item.type | get_key_info_category_code }}        </p>      </template>      <template #cell(duty)="props">        <p>          {{ props.item.duty_type | get_duty_type_code }}        </p>      </template>      <template #cell(employee)="props">        <div class="d-flex">          <img            :src="props.item.employeeImg"            onError="this.onerror=null;this.src='https://tuss.io/tusd_images/profile/human_icon.png';"            class="avatar-xs my-auto"            alt          />          <p class="ml-2">{{ props.item.employee }}</p>        </div>      </template>      <template #row-details="props">        <div class="media bg-secondary p-2">          <b-col class="media-body" cols="12">            <b-row>              <b-col cols="5">                <p class="text-muted">Task:</p>                <p class="mt-1">{{ props.item.task_name }}</p>              </b-col>              <b-col class="d-flex" cols="7">                <b-col class="p-0" cols="6">                  <p class="text-muted">Employee:</p>                  <div class="mt-1 d-flex">                    <img                      :src="props.item.employeeImg"                      onError="this.onerror=null;this.src='https://tuss.io/tusd_images/profile/human_icon.png';"                      class="avatar-xs"                      alt                    />                    <p class="align-self-center ml-2">                      {{ props.item.employee }}                    </p>                  </div>                </b-col>                <b-col class="p-0" cols="6">                  <p class="text-muted">Key Information Type:</p>                  <p class="mt-1">                    {{ props.item.type | get_key_info_category }}                  </p>                </b-col>              </b-col>            </b-row>            <b-row class="mt-3">              <b-col cols="5">                <p class="text-muted">Duty:</p>                <p class="mt-1">{{ props.item.duty_full }}</p>              </b-col>              <b-col class="d-flex" cols="7">                <b-col class="p-0" cols="6">                  <p class="text-muted">Duty Type:</p>                  <p class="mt-1">                    {{ props.item.duty_type | get_duty_type_name }}                  </p>                </b-col>                <b-col class="p-0" cols="6">                  <p class="text-muted">By Law:</p>                  <p class="mt-1">{{ props.item.regulation }}</p>                </b-col>              </b-col>            </b-row>            <b-row class="mt-3">              <b-col cols="3">                <p class="text-muted">Reason description:</p>                <p class="mt-1">{{ props.item.reason }}</p>              </b-col>              <b-col cols="3">                <p class="text-muted">Suggestion:</p>                <div class="mt-1">                  <p>{{ props.item.suggestion }}</p>                </div>              </b-col>              <b-col cols="3">                <p class="text-muted">Created date:</p>                <p class="mt-1">{{ props.item.created_date | datetime }}</p>              </b-col>              <b-col cols="3">                <p class="text-muted">Diagnosis:</p>                <p class="mt-1">                  <b-badge                    v-for="(diagnose, index) in props.item.diagnoses"                    :key="index"                    variant="primary"                    >{{ diagnose | get_diagnosis_template }}</b-badge                  >                </p>              </b-col>            </b-row>          </b-col>        </div>      </template>    </b-table>  </div></template><script>export default {  name: 'DashboardKeyInfoTable',  filters: {    reverse(array) {      return array.slice().reverse();    },  },  props: {    tableData: {      type: [Array, Object],      default() {        return [];      },    },    type: {      type: String,      default() {        return '';      },    },  },  data() {    return {      totalRows: 1,      tableFields: [        { key: 'sequence', label: '' },        {          key: 'type',          label: 'Key info type',          sortable: true,        },        {          key: 'duty',          label: 'Duty',          sortable: true,        },        {          key: 'task_code',          label: 'Task code',        },        {          key: 'task_name',          label: 'Task name',          sortable: true,        },        {          key: 'employee',          label: 'Employee',        },        {          key: 'ach_score',          label: 'Achievement Score',        },        {          key: 'affects_salary',          label: 'Affects salary',        },        {          key: 'dropdown',          label: '',        },      ],      tableDatas: [],      dataList: [],      taskNameList: [],      employees: [],    };  },  watch: {    tableData(data) {      this.tableDatas = [];      this.dataList = [];      this.employees = this.$store.getters.company.employees;      const TaskList = [];      let employee = '';      let employeeImg = null;      if (data.task !== null) {        for (const i in data) {          for (const j in this.employees) {            if (this.employees[j].partner__id === data[i].employee) {              employee =                this.employees[j].partner__last_name +                ' ' +                this.employees[j].partner__name;              employeeImg = this.employees[j].partner__picture;            }          }          let affectsSalary = false;          if (data[i].conflict_category === 'duty_affect_salary') {            affectsSalary = true;          }          this.dataList.push({            id: data[i].id,            task: data[i].task,            task_name: 'N/A',            task_code: 'N/A',            employeeImg,            employee,            duty: data[i].duty,            duty_type: data[i].duty_type,            ach_score: data[i].point,            type: data[i].conflict_type,            affects_salary: affectsSalary,            reason: data[i].reason,            suggestion: data[i].suggestion,            created_date: data[i].created_date,            diagnoses: data[i].diagnoses,          });          if (!TaskList.includes(data[i].task)) {            TaskList.push(data[i].task);          }        }      }      this.getTaskInfoByIds({ ids: TaskList });    },    taskNameList(data) {      for (const i in this.dataList) {        for (const j in data) {          if (this.dataList[i].task === data[j].id) {            this.dataList[i].task_name = data[j].name;            this.dataList[i].task_code = data[j].code;          }        }        // this.dataList.duty      }      this.tableDatas = this.dataList.reverse();    },  },  mounted() {},  methods: {    linkGen(pageNum) {      return pageNum === 1 ? '?' : `?page=${pageNum}`;    },    check(data) {      // if (parseInt(data) < 0) {      //   return 'text-danger';      // } else if (parseInt(data) < 0) {      //   return 'text-success';      // } else {      //   return '';      // }      if (parseInt(data) < 0) {        return 'text-danger';      } else {        return '';      }    },    toggleDetails(rowData) {      // this.$refs.createCItable.toggleDetailRow(rowData.task_id);      this.$set(        this.tableDatas[rowData.index],        '_showDetails',        !this.tableDatas[rowData.index]._showDetails      );      if (this.tableDatas[rowData.index]._showDetails) {        this.getDuty(rowData.item.duty + '/', rowData.index);      }    },    async getDuty(param, index) {      const response = await this.$store.dispatch('getDuty', param);      if (response.status === 200) {        this.tableDatas[index].regulation = response.data.reg_name;        this.tableDatas[index].duty_full =          response.data.reg_short_name +          ' ' +          response.data.code +          ' ' +          response.data.name;        this.tableDatas.push('');        this.tableDatas.pop();        // this.taskNameList = response.data.return_data;      }    },    async getTaskInfoByIds(param) {      const response = await this.$store.dispatch('getTaskInfoByIds', param);      if (response.status === 200) {        this.taskNameList = response.data.return_data;      }    },  },};</script><style scoped></style>