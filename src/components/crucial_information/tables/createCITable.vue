<template>  <div>    <b-table      id="createCItable"      ref="createCItable"      :fields="tableFields"      :items="TaskData"    >      <template #cell(dropdown)="props">        <i          :id="props.item"          class="dropdown bx bxs-chevron-down-circle task-detail-icon"          :class="{ active: props.detailsShowing === true }"          @click="toggleDetails(props)"        ></i>      </template>      <template #cell(sequence)="props">        {{ props.index + 1 }}      </template>      <template #cell(task_name)="props">        <router-link          :to="{            name: 'task-detail',            query: {              id: props.item.task_id,            },          }"          class="task-link"        >          {{ props.item.task_name }}        </router-link>      </template>      <template #cell(due_task)="props" class="d-inline">        <div          v-if="            props.item.due_task &&            props.item.executing_employee_id === parseInt($route.params.id)          "          class="due bg-danger"        >          due        </div>        <div          v-else-if="            props.item.due_task &&            props.item.executing_employee_id !== parseInt($route.params.id)          "          class="due bg-warning"        >          due        </div>        <div v-if="props.item.is_conflicted" class="conflict bg-warning">          conflict        </div>      </template>      <template #row-details="props">        <TableDetail          :row-data="props.item"          :planned-task="plannedTask"          :detail-view="detailView"          :hide="hide"          :executing-employee="props.item.executing_employee_id"          :algorithm="props.item.task_algorithm"          @emit_data="planningData"        />      </template>    </b-table>  </div></template><script>import TableDetail from '@/components/crucial_information/tables/createCITableDetail';export default {  name: 'CreateCITable',  components: { TableDetail },  props: {    tasks: {      type: [Array, Object],      default() {        return [];      },    },    plannedTask: {      type: Object,      default() {        return {};      },    },    detailView: {      type: Boolean,      default() {        return false;      },    },    showMyTask: {      type: Boolean,      default() {        return false;      },    },    dueTasks: {      type: Boolean,      default() {        return false;      },    },    hide: {      type: Boolean,      default() {        return false;      },    },  },  data() {    return {      perPage: 5,      tableFields: [        {          key: 'sequence',          label: '',        },        {          key: 'task_code',          label: 'Task code',          sortable: true,          thStyle: { width: '140px' },        },        {          key: 'task_name',          label: 'Task name',          sortable: true,        },        {          key: 'task_departments_short_name',          label: 'Department',        },        {          key: 'task_planned_hour',          label: 'Planning hour',        },        {          key: 'task_executing_employee',          label: 'Executing employee',          sortable: true,        },        {          key: 'due_task',          label: 'State',          sortable: true,        },        {          key: 'dropdown',          label: '',        },      ],      TaskData: {        task_stage_groups: [],      },      TaskDetails: [],    };  },  watch: {    dueTasks() {      for (const i in this.TaskData) {        if (          this.TaskData[i].due_task &&          this.TaskData[i].task_executing_employee ===            parseInt(this.$route.params.id)        ) {          this.toggleClass(this.TaskData[i].task_id);          this.$set(this.TaskData[i], '_showDetails', this.dueTasks);        }      }    },    detailView() {      this.showAllTaskDetail();    },    showMyTask(data) {      // if (data) {      //   const planData = [];      //   for (const i in this.TaskData) {      //     if (      //       this.TaskData[i].executing_employee_id ===      //       parseInt(this.$route.params.id)      //     ) {      //       planData.push(this.TaskData[i]);      //     }      //   }      //   this.TaskData = planData;      // } else {      //   this.TaskData = this.tasks;      // }      if (data) {        this.showMyTasks();      } else {        this.TaskData = this.tasks;      }    },    plannedTask(data) {      if (data.json_data) {        const planned_tasks = data.json_data.planned_tasks;        const list_temp = [];        const list_temp2 = [];        for (const i in this.tasks) {          for (const j in this.tasks[i].task_stage_groups) {            for (const l in this.tasks[i].task_stage_groups[j].stage) {              list_temp.push(this.tasks[i].task_stage_groups[j].stage[l]);              list_temp2.push(                this.tasks[i].task_stage_groups[j].stage[l].task_stage_id              );            }          }        }        for (const i in planned_tasks) {          for (const j in list_temp) {            if (list_temp[j].task_stage_id === planned_tasks[i].task_stage) {              data.json_data.planned_tasks[i].is_due = list_temp[j].is_due;            }          }          if (!list_temp2.includes(planned_tasks[i].task_stage)) {            data.json_data.planned_tasks[i].is_due = false;          }        }      }    },    tasks(data) {      this.TaskData = [];      this.TaskData = data;      if (this.showMyTask) {        this.showMyTasks();      }    },  },  beforeMount() {    this.TaskData = this.tasks;    this.$store.state['nextWeekPlanData'] = undefined;  },  mounted() {},  methods: {    showMyTasks() {      const planData = [];      const jsonData = this.tasks.slice();      for (const i in jsonData) {        let planStageGrp = {};        const planStgGrpArray = [];        const stageGrp = jsonData[i].task_stage_groups;        for (const j in stageGrp) {          const planStage = [];          const stage = stageGrp[j].stage;          for (const l in stage) {            if (stage[l].employee_id === parseInt(this.$route.params.id)) {              planStage.push(stage[l]);            }          }          if (planStage.length > 0) {            planStageGrp = { ...stageGrp[j] };            planStageGrp.stage = planStage;            planStgGrpArray.push(planStageGrp);          }        }        let tempJson = {};        if (planStgGrpArray.length > 0) {          tempJson = { ...jsonData[i] };          tempJson.task_stage_groups = planStgGrpArray;        }        if (tempJson.task_stage_groups) {          planData.push(tempJson);        }      }      this.TaskData = planData;    },    planningData(data) {      for (const i in this.TaskData) {        for (const j in data.plannedTask) {          if (this.TaskData[i].task_id === data.plannedTask[j].taskId) {            let totalHour = data.plannedTask[j].totalHour;            let totalMin = data.plannedTask[j].totalMin;            if (totalMin >= 60) {              const min = Math.floor(totalMin / 60);              totalMin = totalMin - 60 * min;              totalHour += min;            }            if (totalHour > 0 || totalMin > 0) {              if (!totalHour.toString().charAt(1)) {                totalHour = '0' + totalHour;              }              if (!totalMin.toString().charAt(1)) {                totalMin = '0' + totalMin;              }              this.TaskData[i].task_planned_hour = totalHour + ':' + totalMin;            } else {              this.TaskData[i].task_planned_hour = null;            }          }        }      }      delete data.plannedTask;      this.$emit('task_data', data);    },    toggleDetails(rowData) {      // this.$refs.createCItable.toggleDetailRow(rowData.task_id);      this.$set(        this.TaskData[rowData.index],        '_showDetails',        !this.TaskData[rowData.index]._showDetails      );    },    showAllTaskDetail() {      for (const i in this.TaskData) {        this.toggleClass(this.TaskData[i].task_id);        this.$set(this.TaskData[i], '_showDetails', this.detailView);      }    },    async toggleClass(data) {      await document.getElementById(data).classList.toggle('active');    },  },};</script><style scoped>.due {  text-align: center;  border-radius: 15%;}.conflict {  text-align: center;  border-radius: 15%;}</style>