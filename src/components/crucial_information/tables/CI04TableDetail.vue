<template>  <div class="row-detail">    <table class="stage-detail">      <tbody>        <div          v-for="(stageGRP, indx) in taskStageGrp"          :key="stageGRP.task_stage_group_id"          class="w-100"        >          <tr>            <td>              {{ stageGRP.stage_group_code }}            </td>            <td class="w-100">              {{ stageGRP.stage_group_name }}            </td>            <td style="width: 40px">              {{ stageGRP.plan_hour }}            </td>            <td>              <b-progress                class="stage-progress"                :max="stageGRP.maxPorgress"                show-value                style="width: 150px"              >                <b-progress-bar                  :value="stageGRP.progress.complete"                  variant="success"                ></b-progress-bar>                <b-progress-bar                  :value="stageGRP.progress.onProcess"                  variant="warning"                ></b-progress-bar>                <b-progress-bar                  :value="stageGRP.progress.onQueue"                  variant="danger"                ></b-progress-bar>              </b-progress>            </td>            <td style="width: 130px">              <router-link                v-if="stageGRP.entry"                :to="{                  name: 'form-edit',                  query: {                    id: stageGRP.form,                    did: stageGRP.entry,                    tsk: taskId,                    tsg: stageGRP.task_stage_group_id,                  },                }"                class="btn btn-secondary newTab"                target="_blank"                >Perform task</router-link              >              <router-link                v-else                :to="{                  name: 'form-entry',                  query: {                    id: stageGRP.form,                    tal: algorithm,                    tsk: taskId,                    tsg: stageGRP.task_stage_group_id,                  },                }"                class="btn btn-secondary newTab"                target="_blank"                >Perform task</router-link              >            </td>            <td style="width: 25px; height: 25px">              <i                class="bx bxs-chevron-down-circle task-detail-icon"                @click="showTaskStageDetail(indx)"              ></i>            </td>          </tr>          <tr v-if="stageGRP.showStages">            <td colspan="5">              <table class="stage-detail" style="background-color: transparent">                <tr v-for="stage in stageGRP.task_stages" :key="stage.stage">                  <td>{{ stage.stage_code }}</td>                  <td class="w-100">{{ stage.stage_name }}</td>                  <td>{{ stage.plan_hour }}</td>                  <td>                    <div v-if="stage.employees.length > 0">                      <ul class="user-list">                        <li                          v-for="(item, index) in stage.employees"                          :key="index"                        >                          <img                            :src="item | get_employee_pict"                            onError="this.onerror=null;this.src='https://tuss.io/tusd_images/profile/human_icon.png';"                            class="                              border-white                              rounded-circle                              con-vs-avatar                              -m-1                            "                            width="25px"                            :id="`img_${indx}_${stage.stage}_${stageGRP.stage_group_id}_${index}`"                            v-b-tooltip.hover                          />                          <b-tooltip                            :target="`img_${indx}_${stage.stage}_${stageGRP.stage_group_id}_${index}`"                            >{{ item | get_employee_info }}</b-tooltip                          >                        </li>                      </ul>                    </div>                  </td>                  <td>                    <b-badge v-if="stage.state === 'on_queue'" variant="danger"                      >On queue                    </b-badge>                    <b-badge                      v-else-if="stage.state === 'on_process'"                      variant="warning"                      >On process                    </b-badge>                    <b-badge                      v-else-if="stage.state === 'complete'"                      variant="success"                      >Complete                    </b-badge>                  </td>                </tr>              </table>            </td>          </tr>        </div>      </tbody>    </table>  </div></template><script>export default {  name: 'CI04TableDetail',  props: {    rowData: {      type: Object,      required: true,    },    algorithm: {      type: Number,      default: null,    },    taskId: {      type: Number,      default: null,    },  },  data() {    return {      taskStageGrp: [],    };  },  beforeMount() {    this.taskStageGrp = this.rowData.task_stage_groups;    const algorithms = this.$store.getters.company.algorithm;    for (const i in this.taskStageGrp) {      const entry = this.taskStageGrp[i].entry;      if (entry === null || entry === 'null' || entry === undefined) {        delete this.taskStageGrp[i].entry;      }      const form = this.taskStageGrp[i].form;      if (form === null || form === 'null' || form === undefined) {        for (const j in algorithms) {          for (const l in algorithms[j].stage_groups) {            if (              algorithms[j].stage_groups[l].id ===              this.taskStageGrp[i].stage_group_id            ) {              this.taskStageGrp[i].form = parseInt(                algorithms[j].stage_groups[l].form              );            }          }        }      }      this.taskStageGrp[i].showStages = false;    }  },  methods: {    showTaskStageDetail(index) {      this.taskStageGrp = [];      this.rowData.task_stage_groups[index].showStages =        !this.rowData.task_stage_groups[index].showStages;      this.taskStageGrp = this.rowData.task_stage_groups;      event.target.classList.toggle('active');    },  },};</script><style scoped>.newTab {  background-color: #2a3042;  min-width: 130px;  width: 130px;  color: white;}</style>