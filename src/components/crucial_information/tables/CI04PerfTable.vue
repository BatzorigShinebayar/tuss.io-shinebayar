<template>  <div>    <b-table striped :hover="true" :fields="tableField" :items="tableData">      <template #cell(checkbox)="props">        <div v-if="!props.item.is_conclusion_abnormal" class="d-flex">          <b-form-checkbox            v-model="props.item.is_checked"            :value="true"            class="mx-auto"            @change="checked(props.item)"          />        </div>      </template>      <template #cell(employee)="props">        <router-link          :to="`/crucial-information/${$route.params.weekId}/04/employee/${props.item.employee.employee_id}/${$route.params.date}`"          class="task-link"        >          {{ props.item.employee.employee_last_name }}          {{ props.item.employee.employee_name }}        </router-link>      </template>      <template #cell(summary)="props">        <div          v-if="props.item.is_conclusion_abnormal"          class="bg-danger text-white px-1 conflictType"        >          not Okay!        </div>        <div v-else class="bg-success text-white conflictType">Okay!</div>      </template>      <template #cell(send_date)="props" class="d-inline">        {{ props.item.sent_date | datetime }}      </template>      <template #cell(confirm_date)="props" class="d-inline">        {{ props.item.confirm_date | datetime }}      </template>      <template #cell(state)="props">        <div          v-if="props.item.state === 'draft'"          class="bg-danger text-white px-1 conflictType"        >          Not sent        </div>        <div          v-else-if="props.item.state === 'sent'"          class="bg-warning text-dark px-1 conflictType"        >          Checking        </div>        <div v-else class="bg-success text-white px-1 conflictType">          Confirmed        </div>      </template>      <template #cell(action)="props">        <b-dropdown          v-if="            props.item.state === 'sent' &&            isMyAch(props.item.employee.employee_id) &&            canConfirm &&            canReject          "          text="Action"          variant="dark"          class="mx-4"        >          <b-dropdown-item            v-if="canConfirm"            :disabled="confirmDisable"            @click="confirmDailyCheck(props.item.id, props.index)"            >Confirm</b-dropdown-item          >          <b-dropdown-item            v-if="canReject"            v-b-modal.reject-CI            @click="rejectModal(props.item, props.index)"            >Reject</b-dropdown-item          >        </b-dropdown>      </template>      <!--      <template #cell(dropdown)="props">-->      <!--        <i-->      <!--          :id="props.item"-->      <!--          class="dropdown bx bxs-chevron-down-circle task-detail-icon"-->      <!--          :class="{ active: props.detailsShowing === true }"-->      <!--          @click="showTaskDetail(props)"-->      <!--        ></i>-->      <!--      </template>-->      <!--      <template #row-details="props">-->      <!--        <CI04TableDetail :row-data="props.item" :options="props.item" />-->      <!--      </template>-->    </b-table>    <b-modal id="reject-CI" ref="reject-CI" title="Rejecting reason">      <b-col class="d-flex mb-2" cols="12">        <p class="modal-text mr-2">Employee:</p>        <b class="modal-text">{{ modalData.employee }}</b>      </b-col>      <b-col class="d-flex mb-2" cols="12">        <p class="modal-text mr-2">Date:</p>        <b class="modal-text">{{ modalData.date }}</b>      </b-col>      <b-col cols="12">        <p class="modal-text">Reason:</p>        <b-form-textarea          v-model="modalData.reason"          placeholder="Write reason why you rejecting"        ></b-form-textarea>        <p id="reason_warning" class="text-danger" style="display: none">          Please write reason why you rejecting        </p>      </b-col>      <template #modal-footer="{ cancel }">        <div class="w-100">          <b-button            variant="dark"            class="ml-2 float-right"            :disabled="modalDisable"            @click="rejectCI"          >            Submit          </b-button>          <b-button class="float-right" @click="cancel()"> Cancel </b-button>        </div>      </template>    </b-modal>  </div></template><script>import Vue from 'vue';import CI04TableDetail from '@/components/crucial_information/tables/TableDetail';Vue.component('CI04TableDetail', CI04TableDetail);export default {  name: 'CI04PerfTable',  components: {},  props: {    tableData: {      type: [Array, Object],      default() {        return [];      },    },  },  data() {    return {      tableField: [        {          key: 'checkbox',          label: '',        },        {          key: 'employee',          label: 'Employee',          sortable: true,        },        {          key: 'summary',          label: 'Summary',          sortable: true,        },        {          key: 'complete_stages',          label: 'Stage completed',        },        {          key: 'reports_and_reminders',          label: 'Report and reminder',        },        {          key: 'conflicts_and_problems',          label: 'Conflict and Problems',        },        {          key: 'achievement_score',          label: 'Achievment score',        },        {          key: 'send_date',          label: 'Sent date',        },        {          key: 'confirm_date',          label: 'Confirm date',        },        {          key: 'state',          label: 'State',          sortable: true,        },        {          key: 'action',          label: '',          thClass: 'actionClass',        },      ],      canConfirm: false,      canReject: false,      isHM1: false,      modalData: {        employee: null,        date: null,        reason: null,        id: null,        index: null,      },      checkedList: [],      confirmDisable: false,      modalDisable: false,    };  },  watch: {    checkedList(data) {      if (data.length !== 0) {        this.$emit('checked_criticalInfo', data);      }    },  },  beforeMount() {    const departments = this.$store.getters.company.department;    if (this.permission('ach4_hm1')) {      this.canConfirm = true;      this.canReject = true;      this.isHM1 = true;    } else if (this.$route.params.type === 'department') {      for (const i in departments) {        if (          departments[i].id === parseInt(this.$route.params.id) &&          departments[i].manager__id === this.$store.getters.user.partner_id        ) {          if (this.permission('ach4_hm2')) {            this.canConfirm = true;            this.canReject = true;          }        }      }    }  },  methods: {    showTaskDetail(rowData) {      this.$set(        this.tableData[rowData.index],        '_showDetails',        !this.tableData[rowData.index]._showDetails      );    },    checked(data) {      if (data.is_checked && data.state === 'sent') {        this.checkedList.push(data.id);      } else {        const index = this.checkedList.indexOf(data.id);        if (index > -1) {          this.checkedList.splice(index, 1);        }      }    },    rejectModal(data, index) {      this.modalData.employee =        data.employee.employee_last_name + ' ' + data.employee.employee_name;      this.modalData.date = this.$route.params.date;      this.modalData.id = data.id;      this.modalData.index = index;    },    async rejectCI() {      this.modalDisable = true;      if (this.modalData.reason !== null) {        document.getElementById('reason_warning').style.display = 'none';        const id = this.modalData.id;        const index = this.modalData.index;        const param = id + '/';        const response = await this.get_daily_check_create_data(param);        this.$refs['reject-CI'].hide();        if (response) {          const params = response.employee_check.json_data;          params.state = 'draft';          params.description = this.modalData.reason;          await this.dailyCheckUpdate(params, id, index);        }      } else {        document.getElementById('reason_warning').style.display = 'block';      }    },    isMyAch(data) {      if (!this.isHM1) {        if (data !== this.$store.getters.user.partner_id) {          return true;        } else {          return false;        }      } else {        return true;      }    },    async confirmDailyCheck(dailyCheckId, index) {      this.confirmDisable = true;      const param = dailyCheckId + '/';      const response = await this.get_daily_check_create_data(param);      if (response) {        const params = response.employee_check.json_data;        params.state = 'confirm';        params.department = response.employee_check.department;        params.organization = response.employee_check.organization;        params.manager = response.employee_check.manager;        await this.dailyCheckUpdate(params, dailyCheckId, index);      }    },    async get_daily_check_create_data(params) {      const response = await this.$store.dispatch(        'get_daily_check_create_data',        params      );      if (response.status === 200) {        return response.data;      }    },    async dailyCheckUpdate(params, id, index) {      const sendParams = {};      sendParams.urlPath = id + '/';      sendParams.data = params;      const response = await this.$store.dispatch(        'dailyCheckUpdate',        sendParams      );      if (response.status === 200 && response.data.result) {        /* eslint-disable vue/no-mutating-props */        this.confirmDisable = false;        this.modalSubmit = false;        this.tableData[index].state = sendParams.data.state;      }    },    checkIsConflict(problem, report) {      const result = problem + report;      if (result > 0) {        return true;      } else {        return false;      }    },  },};</script><style scoped>.conflictType {  border-radius: 20px;  text-align: center;}.dark-btn {  background: #1f304a;  border-radius: 4px;  color: white;}.actionClass {  max-width: 80px !important;}</style>