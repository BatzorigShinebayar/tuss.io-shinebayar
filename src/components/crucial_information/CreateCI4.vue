<template>  <div>    <b-sidebar      id="sidebarCI4"      ref="sidebarCI4"      title="Daily check"      right      shadow      backdrop      v-model="sidebarToggle"      lazy      class="sidebar-lg"    >      <b-row>        <b-col style="background-color: #f2f2f2" cols="12">          <b-row>            <b-col class="pr-0" cols="4">              <b-col class="p-0 d-flex" cols="12">                <div id="addProblem" @click="changeTab('addProblem')">                  <div class="circle float-left avatar-sm active">                    <span class="avatar-title">                      <i                        class="                          bx bx-message-alt-error bx-burst                          font-size-24                          check-circle                        "                      />                    </span>                  </div>                </div>                <p class="text align-self-center">Conflict and problems</p>                <div class="hr align-self-center" />              </b-col>            </b-col>            <b-col class="pr-0" cols="4">              <b-col class="p-0 d-flex" cols="12">                <div id="addScore" @click="changeTab('addScore')">                  <div class="circle float-left avatar-sm">                    <span class="avatar-title">                      <i class="bx bx-donate-heart font-size-24 check-circle" />                    </span>                  </div>                </div>                <p class="text align-self-center">Achievement</p>                <div class="hr align-self-center" />              </b-col>            </b-col>            <b-col class="pr-0" cols="4">              <b-col class="p-0 d-flex" cols="12">                <div id="addReport" @click="changeTab('addReport')">                  <div class="circle float-left avatar-sm">                    <span class="avatar-title">                      <i                        class="bx bx-comment-error font-size-24 check-circle"                      />                    </span>                  </div>                </div>                <p class="text align-self-center">Report and reminder</p>              </b-col>            </b-col>          </b-row>        </b-col>      </b-row>      <b-row>        <b-col style="margin-bottom: 60px" cols="12">          <addProblem            v-if="tabMenu === 'addProblem'"            :problem-data.sync="problems"            :system-problem-data="system_problems"            @emit_data="emitProblemData"          />          <addScore            v-else-if="tabMenu === 'addScore'"            :achievement-data.sync="achievements"            @emit_data="emitAchievementData"          />          <addReport            v-else-if="tabMenu === 'addReport'"            :reminder-data.sync="reminders"            @emit_data="emitReminderData"          />          <CI4Finish v-else-if="tabMenu === 'finished'" />        </b-col>      </b-row>      <b-row v-if="tabMenu !== 'finished'">        <b-col          class="d-flex p-0 bottom"          style="background-color: #f2f2f2"          cols="12"        >          <b-col id="cancel" class="m-3 btn btn-secondary footer" cols="2">            <p class="button-text" @click="cancel">Cancel</p>          </b-col>          <b-col id="back" class="m-3 btn btn-primary footer" cols="4">            <p v-if="canUpd" class="button-text" @click="save">Save</p>          </b-col>          <b-col id="next" class="m-3 btn btn-success footer" cols="4">            <p v-if="canSend" class="button-text" @click="send">Send</p>          </b-col>        </b-col>      </b-row>    </b-sidebar>  </div></template><script>import addProblem from '@/components/crucial_information/CreateCITabs/addProblem';import addScore from '@/components/crucial_information/CreateCITabs/addScore';import addReport from '@/components/crucial_information/CreateCITabs/addReport';import CI4Finish from '@/components/crucial_information/CreateCITabs/Finished';export default {  name: 'CreateCI04',  components: {    addProblem,    addScore,    addReport,    CI4Finish,  },  props: {    sidebarToggle: {      type: Boolean,      default() {        return false;      },    },  },  data() {    return {      tabMenu: 'addProblem',      sendingWeeklyData: {        dailycheck_id: 0,        employee: 0,        date: '',        state: '',        user_id: 0,        is_conclusion_abnormal: false,        system_problems: [],      },      problems: [],      system_problems: [],      achievements: [],      reminders: [],      canSend: this.permission('ach4_snd'),      canUpd: this.permission('ach4_upd'),    };  },  watch: {    sidebarToggle(data) {      this.$root.$emit('bv::toggle::collapse', 'sidebarCI4');      this.$store.dispatch('CICreateSideMenuToggle', data);    },  },  beforeMount() {    const dailyCheckData = this.$store.getters['dailyCheckData'];    this.problems = dailyCheckData.problems;    this.achievements = dailyCheckData.achievements;    this.reminders = dailyCheckData.reminders;    this.system_problems = dailyCheckData.system_problems;  },  methods: {    closeSideBar() {      this.sidebarToggle = false;      // this.$store.dispatch('CICreateSideMenuToggle', false);    },    emitProblemData(data) {      const dailyCheckData = this.$store.getters['dailyCheckData'];      const problems = data.problemData;      const systemProblem = data.systemProblem;      const dailyCheckId = data.dailycheck_id;      dailyCheckData.problems = problems;      dailyCheckData.system_problems = systemProblem;      dailyCheckData.dailycheck_id = dailyCheckId;      this.problems = problems;      this.$store.dispatch('dailyCheckData', dailyCheckData);    },    emitAchievementData(data) {      const dailyCheckData = this.$store.getters['dailyCheckData'];      const achievements = data.achievementData;      const dailyCheckId = data.dailycheck_id;      dailyCheckData.achievements = achievements;      dailyCheckData.dailycheck_id = dailyCheckId;      this.achievements = achievements;      this.$store.dispatch('dailyCheckData', dailyCheckData);    },    emitReminderData(data) {      const dailyCheckData = this.$store.getters['dailyCheckData'];      const reminders = data.reminderData;      const dailyCheckId = data.dailycheck_id;      dailyCheckData.reminders = reminders;      dailyCheckData.dailycheck_id = dailyCheckId;      this.reminders = reminders;      this.$store.dispatch('dailyCheckData', dailyCheckData);    },    setProblems(problems) {      const list = [];      let checker = true;      for (const i in problems) {        const jsonData = {};        jsonData.employee = this.$route.params.id;        const dailyCheckData = this.$store.getters['dailyCheckData'];        jsonData.conflict_date = dailyCheckData.date;        if (problems[i].conflict_type) {          jsonData.conflict_type = problems[i].conflict_type;          jsonData.conflict_category = problems[i].conflict_category;        } else {          checker = false;          alert('Please choose conflict type');          break;        }        if (problems[i].diagnose_types) {          jsonData.diagnose_types = problems[i].diagnose_types;        }        if (!problems[i].regulation) {          checker = false;          alert('Please choose regulation');          break;        }        if (problems[i].duty) {          jsonData.duty = problems[i].duty;          jsonData.duty_type = problems[i].duty_type;          jsonData.point = problems[i].point;        } else {          checker = false;          alert('Please choose regulation duty');          break;        }        if (problems[i].task) {          jsonData.task = problems[i].task;          if (problems[i].task_stage_id) {            jsonData.task_stage = problems[i].task_stage_id;          } else {            jsonData.task_stage = problems[i].task_stage;          }          jsonData.stage = problems[i].stage;        }        if (problems[i].reason) {          jsonData.reason = problems[i].reason;        } else {          checker = false;          alert('Please insert conflict reason');          break;        }        if (problems[i].suggestion) {          jsonData.suggestion = problems[i].suggestion;        } else {          checker = false;          alert('Please insert suggest for conflict');          break;        }        jsonData.created_partner = this.$store.getters.user.partner_id;        list.push(jsonData);      }      if (checker) {        return list;      } else {        return checker;      }    },    setAchivReminder(data, type) {      const list = [];      let checker = true;      for (const i in data) {        const jsonData = {};        jsonData.employee = this.$route.params.id;        const dailyCheckData = this.$store.getters['dailyCheckData'];        jsonData.conflict_date = dailyCheckData.date;        if (data[i].employee) {          jsonData.employee = data[i].employee;        } else {          checker = false;          alert('[' + type + '] Please choose employee');          break;        }        if (data[i].conflict_type) {          jsonData.conflict_type = data[i].conflict_type;          jsonData.conflict_category = data[i].conflict_category;        } else {          checker = false;          alert('[' + type + '] Please choose conflict type');          break;        }        if (!data[i].regulation) {          checker = false;          alert('[' + type + '] Please choose regulation');          break;        }        if (data[i].duty) {          jsonData.duty = data[i].duty;          jsonData.duty_type = parseInt(data[i].dtp_id);          if (!data[i].point) {            jsonData.point = parseFloat(data[i].dtp_point);          } else {            jsonData.point = parseFloat(data[i].point);          }        } else {          checker = false;          alert('[' + type + '] Please choose regulation duty');          break;        }        if (data[i].task) {          jsonData.task = data[i].task;          if (data[i].task_stage_id) {            jsonData.task_stage = data[i].task_stage_id;          } else {            jsonData.task_stage = data[i].task_stage;          }          jsonData.stage = data[i].stage;        }        if (data[i].reason) {          jsonData.reason = data[i].reason;        } else {          checker = false;          alert('[' + type + '] Please insert reason');          break;        }        if (data[i].suggestion) {          jsonData.suggestion = data[i].suggestion;        } else {          checker = false;          alert('[' + type + '] Please insert suggest');          break;        }        jsonData.created_partner = this.$store.getters.user.partner_id;        list.push(jsonData);      }      if (checker) {        return list;      } else {        return checker;      }    },    prepareSendData(state) {      if (typeof this.$store.getters['dailyCheckData'] !== 'undefined') {        this.sendingWeeklyData = this.$store.getters['dailyCheckData'];      }      const dailyCheckData = this.sendingWeeklyData;      dailyCheckData.is_conclusion_abnormal = this.checkIsAbnormal();      let checker = true;      if (this.setProblems(this.problems) !== false) {        dailyCheckData.problems = this.setProblems(this.problems);      } else {        checker = false;      }      if (        this.setAchivReminder(this.reminders, 'Reports and reminders') !== false      ) {        dailyCheckData.reminders = this.setAchivReminder(this.reminders);      } else {        checker = false;      }      if (this.setAchivReminder(this.achievements, 'Achievements') !== false) {        dailyCheckData.achievements = this.setAchivReminder(this.achievements);      } else {        checker = false;      }      if (checker) {        dailyCheckData.state = state;        this.dailyCheckUpdate(dailyCheckData);        this.$store.dispatch('dailyCheckData', dailyCheckData);      }    },    cancel() {      this.closeSideBar();    },    send() {      this.prepareSendData('sent');    },    save() {      this.prepareSendData('save');    },    checkIsAbnormal() {      const dailyCheckData = this.$store.getters['dailyCheckData'];      const checkList = dailyCheckData.system_problems + this.problems;      if (checkList.length === 0) {        return false;      } else {        return true;      }    },    async dailyCheckUpdate(params) {      const sendParams = {};      sendParams.urlPath = this.sendingWeeklyData.dailycheck_id + '/';      sendParams.data = params;      const response = await this.$store.dispatch(        'dailyCheckUpdate',        sendParams      );      if (response.status === 200 && response.data.result === true) {        this.tabMenu = 'finished';      }    },    changeTab(event) {      this.tabMenu = event;      const circle = document.querySelectorAll('.circle');      circle.forEach((i) => {        i.classList.remove('active');      });      document        .querySelectorAll('#' + this.tabMenu + ' .circle')[0]        .classList.add('active');      const checkCircle = document.querySelectorAll('.check-circle');      checkCircle.forEach((i) => {        i.classList.remove('bx-burst');      });      document        .querySelectorAll('#' + this.tabMenu + ' .check-circle')[0]        .classList.add('bx-burst');    },  },};</script><style scoped>#sidebarCI4 {  display: block;}.b-sidebar {  display: block !important;}.sidebar-right {  display: block !important;}.bottom {  position: absolute;  bottom: 0;  left: 0;}.btn-secondary {  background-color: #2a3042;  color: white;}#cancel.btn-secondary {  background-color: white;  color: #2a3042;  border: 1px solid #2a3042;}.btn-secondary.footer {  height: 40px;}.button-text {  margin: auto;}.circle {  height: 50px;  width: 50px;  border-radius: 50%;  margin: 20px 20px 20px 20px;  background-color: white;}.check-circle {  color: black;  font-size: 24px;  margin: 25% 25% 25% 25%;}.circle.active {  background-color: orange;}.circle.active .check-circle {  color: white;}.hr {  width: 100px;  height: 1px;  border: 0;  border-top: 2px solid white;  margin: 1em 10px;  padding: 0;}</style>