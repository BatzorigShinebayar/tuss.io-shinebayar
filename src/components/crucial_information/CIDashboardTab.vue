<template>  <div>    <b-col cols="12">      <b-row>        <b-col class="pl-0">          <CIPerfCard :data="dashboard" :date="weekDate" />        </b-col>      </b-row>    </b-col>    <b-col cols="12" class="pt-2 pl-0">      <b-row>        <b-col cols="12">          <div class="card pt-4 pl-4 pr-3 pb-3 bg-white">            <h4 class="font-weight-bold">Highlights</h4>            <b-col class="d-flex" cols="12">              <div class="mr-3 highlight-card">                <div class="card mt-3">                  <div class="card-body">                    <div class="media">                      <b-col class="media-body" cols="12">                        <p class="highlight-title mb-4">Resource Heavy Task</p>                        <p class="highlight-value">{{ heavyTask.data }}</p>                        <p class="mb-3 txt">Hours planned</p>                        <p class="highlight txt">{{ heavyTask.task_name }}</p>                      </b-col>                    </div>                  </div>                </div>              </div>              <div class="mr-3 highlight-card">                <div class="card mt-3">                  <div class="card-body">                    <div class="media">                      <b-col class="media-body" cols="12">                        <p class="highlight-title mb-4">Entangled one</p>                        <p class="highlight-value">{{ tangledTask.data }}</p>                        <p class="mb-3 txt">Employees</p>                        <p class="highlight txt">{{ tangledTask.task_name }}</p>                      </b-col>                    </div>                  </div>                </div>              </div>              <div class="mr-3 highlight-card">                <div class="card mt-3">                  <div class="card-body">                    <div class="media">                      <b-col class="media-body" cols="12">                        <p class="highlight-title mb-4">Longest Ongoing</p>                        <p class="highlight-value">{{ longTask.data }}</p>                        <p class="mb-3 txt">Days</p>                        <p class="highlight txt">{{ longTask.task_name }}</p>                      </b-col>                    </div>                  </div>                </div>              </div>              <div class="mr-3 highlight-card">                <div class="card mt-3">                  <div class="card-body">                    <div class="media">                      <b-col class="media-body" cols="12">                        <p class="highlight-title mb-4">Algorithm on Demand</p>                        <p class="highlight-value mb-3">                          {{ demandAlgorithm.data }}                        </p>                        <p class="highlight txt">{{ demandAlgorithm.name }}</p>                      </b-col>                    </div>                  </div>                </div>              </div>            </b-col>          </div>        </b-col>      </b-row>    </b-col>    <b-col cols="12" class="pt-2 pl-0" v-if="$route.params.type !== 'employee'">      <b-row>        <b-col cols="12">          <div class="card pt-4 pl-4 pr-3 pb-3 bg-transparent">            <h4 class="font-weight-bold">Trophy boards</h4>            <b-col class="d-flex" cols="12">              <div class="mr-3 trophy-card">                <div class="card mt-3 bg-deep-blue text-white">                  <div class="card-body">                    <div class="media">                      <b-col class="media-body" cols="12">                        <p class="highlight-title mb-4">Issue king</p>                        <p class="highlight-value">{{ conflict.data }}</p>                        <p class="mb-3 txt">Issues</p>                        <div class="highlight txt">                          <ul class="user-list" v-if="conflict.data !== '0'">                            <li                              v-for="(item, index) in conflict.employees"                              :key="index"                            >                              <img                                :src="item | get_employee_pict"                                onError="this.onerror=null;this.src='https://tuss.io/tusd_images/profile/human_icon.png';"                                class="avatar-xs con-vs-avatar -m-1"                                :id="`conflict_${index}_${item}`"                                v-b-tooltip.hover                              />                              <b-tooltip                                :target="`conflict_${index}_${item}`"                                >{{ item | get_employee_info }}</b-tooltip                              >                            </li>                          </ul>                          <p v-else>N/A</p>                        </div>                      </b-col>                    </div>                  </div>                </div>              </div>              <div class="mr-3 trophy-card">                <div class="card mt-3 bg-deep-blue text-white">                  <div class="card-body">                    <div class="media">                      <b-col class="media-body" cols="12">                        <p class="highlight-title mb-4">MultiTask King</p>                        <p class="highlight-value text-success">                          {{ multiTask.data }}                        </p>                        <p class="mb-3 txt">Tasks</p>                        <div class="highlight txt">                          <ul class="user-list" v-if="multiTask.data !== '0'">                            <li                              v-for="(item, index) in multiTask.employees"                              :key="index"                              class=""                            >                              <img                                :src="item | get_employee_pict"                                onError="this.onerror=null;this.src='https://tuss.io/tusd_images/profile/human_icon.png';"                                class="avatar-xs con-vs-avatar -m-1"                                :id="`multiTask_${index}_${item}`"                                v-b-tooltip.hover                              />                              <b-tooltip                                :target="`multiTask_${index}_${item}`"                                >{{ item | get_employee_info }}</b-tooltip                              >                            </li>                          </ul>                          <p v-else>N/A</p>                        </div>                      </b-col>                    </div>                  </div>                </div>              </div>              <div class="mr-3 trophy-card">                <div class="card mt-3 bg-deep-blue text-white">                  <div class="card-body">                    <div class="media">                      <b-col class="media-body" cols="12">                        <p class="highlight-title mb-4">                          Responsibility Master                        </p>                        <p class="highlight-value text-primary">                          {{ multiStage.data }}                        </p>                        <p class="mb-3 txt">Task stages assigned</p>                        <div class="highlight txt">                          <ul class="user-list" v-if="multiStage.data !== '0'">                            <li                              v-for="(item, index) in multiStage.employees"                              :key="index"                            >                              <img                                :src="item | get_employee_pict"                                onError="this.onerror=null;this.src='https://tuss.io/tusd_images/profile/human_icon.png';"                                class="avatar-xs con-vs-avatar -m-1"                                :id="`multiTask_${index}_${item}`"                                v-b-tooltip.hover                              />                              <b-tooltip                                :target="`multiTask_${index}_${item}`"                                >{{ item | get_employee_info }}</b-tooltip                              >                            </li>                          </ul>                          <p v-else>N/A</p>                        </div>                      </b-col>                    </div>                  </div>                </div>              </div>              <div class="mr-3 trophy-card">                <div class="card mt-3 bg-deep-blue text-white">                  <div class="card-body">                    <div class="media">                      <b-col class="media-body" cols="12">                        <p class="highlight-title mb-4">Achievement Master</p>                        <p class="highlight-value text-success">                          {{ achievementMaster.data }}                        </p>                        <p class="mb-3 txt">Achievement Score</p>                        <div class="highlight txt">                          <ul                            class="user-list"                            v-if="achievementMaster.data !== '0'"                          >                            <li                              v-for="(                                item, index                              ) in achievementMaster.employees"                              :key="index"                            >                              <img                                :src="item | get_employee_pict"                                onError="this.onerror=null;this.src='https://tuss.io/tusd_images/profile/human_icon.png';"                                class="avatar-xs con-vs-avatar -m-1"                                :id="`multiTask_${index}_${item}`"                                v-b-tooltip.hover                              />                              <b-tooltip                                :target="`multiTask_${index}_${item}`"                                >{{ item | get_employee_info }}</b-tooltip                              >                            </li>                          </ul>                          <p v-else>N/A</p>                        </div>                      </b-col>                    </div>                  </div>                </div>              </div>            </b-col>          </div>        </b-col>      </b-row>    </b-col>    <b-col cols="12" style="min-width: 590px">      <div class="card pt-4 pl-4 pr-3 pb-3 bg-white">        <h4 class="font-weight-bold mb-3">Key information</h4>        <div class="d-flex">          <div            class="btn btn-secondary mr-3"            :class="{ 'bg-deep-blue text-white': keyInfoMenu === 'seeAll' }"            @click="seeAll"          >            See all          </div>          <div            class="btn btn-secondary mr-3"            :class="{ 'bg-deep-blue text-white': keyInfoMenu === 'issues' }"            @click="issues"          >            Issues          </div>          <div            class="btn btn-secondary mr-3"            :class="{              'bg-deep-blue text-white': keyInfoMenu === 'achievements',            }"            @click="achievements"          >            Achievements          </div>          <b-form-select            class="ml-auto"            style="width: 110px"            v-model="keyInfoPageSize"            :options="pageSizeOptions"            @change="keyInfoPageChange"          ></b-form-select>          <!--          <div class="btn btn-secondary mr-3" @click="alerts">Alerts</div>-->        </div>        <KeyInfoTable :table-data="conflicts" class="pt-3" />        <p class="ml-auto">total: {{ keyInfoCount }}</p>        <div class="d-flex justify-content-center mt-3">          <b-pagination            v-if="keyInfoCount > 0 && keyInfoCount / keyInfoPageSize > 1"            v-model="keyInfoPage"            pills            :total-rows="keyInfoCount"            :per-page="keyInfoPageSize"            @change="keyInfoPagination"          ></b-pagination>        </div>      </div>    </b-col>    <b-col cols="12" style="min-width: 590px">      <div class="card pl-4 pr-3 pb-3 bg-white">        <h4 class="font-weight-bold mb-3">Next Week Plan</h4>        <div class="d-flex">          <div            class="btn btn-secondary mr-3"            :class="{              'bg-deep-blue text-white': nextWeekPlanMenu === 'seeAllTask',            }"            @click="seeAllTask"          >            See all          </div>          <!--          <div class="btn btn-secondary mr-3">Issues</div>-->          <div            class="btn btn-secondary mr-3"            :class="{              'bg-deep-blue text-white': nextWeekPlanMenu === 'dueNextWeek',            }"            @click="dueNextWeek"          >            Due Next Week          </div>          <div            class="btn btn-secondary mr-3"            :class="{              'bg-deep-blue text-white': nextWeekPlanMenu === 'startNextWeek',            }"            @click="startNextWeek"          >            Start Next Week          </div>          <b-form-select            class="ml-auto"            style="width: 110px"            v-model="nextWeekPlanPageSize"            :options="pageSizeOptions"            @change="taskPage"          ></b-form-select>        </div>        <PlanTable :table-data="taskStages" class="pt-3" />        <p class="ml-auto">total: {{ nextWeekPlanCount }}</p>        <div class="d-flex justify-content-center mt-3">          <b-pagination            v-if="              nextWeekPlanCount > 0 &&              nextWeekPlanCount / nextWeekPlanPageSize > 1            "            v-model="nextWeekPlanPage"            pills            :total-rows="nextWeekPlanCount"            :per-page="nextWeekPlanPageSize"            @change="taskPagination"          ></b-pagination>        </div>      </div>    </b-col>    <b-col cols="12" style="min-width: 590px">      <div class="card pl-4 pr-3 pb-3 bg-white">        <h4 class="font-weight-bold mb-3">Created tasks in this week</h4>        <TaskTable :table-data="thisWeekTasks" class="pt-3" />      </div>    </b-col>  </div></template><script>import CIPerfCard from '@/components/crucial_information/CIPerfCards';import PlanTable from '@/components/crucial_information/tables/dashboardPlanTable';import KeyInfoTable from '@/components/crucial_information/tables/dashboardKeyInfoTable';import TaskTable from '@/components/crucial_information/tables/dashboardTaskTable';export default {  name: 'CIDashboardTab',  components: {    CIPerfCard,    PlanTable,    KeyInfoTable,    TaskTable,  },  data() {    return {      weekDate: null,      taskStages: [],      isLoaded: false,      conflicts: [],      taskList: [],      taskNameList: [],      heavyTask: { data: '00:00', task_name: 'N/A' },      longTask: { data: '0', task_name: 'N/A' },      tangledTask: { data: '0', task_name: 'N/A' },      demandAlgorithm: { data: '0', name: 'N/A' },      usedAlgorithms: [],      thisWeekTasks: [],      conflict: { data: '0', employees: [] },      multiTask: { data: '0', employees: [] },      achievementMaster: { data: '0', employees: [] },      multiStage: { data: '0', employees: [] },      dashboard: {        Total_issues: '0',        New_task_created: '0',        Due_task_next_week: { state: '0', color: 'text-danger' },      },      weekNumber: null,      nextWeekPlanMenu: 'seeAllTask',      keyInfoMenu: 'seeAll',      mounted: true,      nextWeekPlanCount: 0,      nextWeekPlanPage: 1,      nextWeekPlanPageSize: 10,      pageSizeOptions: [        { value: 10, text: 'Page: 10' },        { value: 20, text: 'Page: 20' },        { value: 50, text: 'Page: 50' },        { value: 100, text: 'Page: 100' },      ],      keyInfoCount: 0,      keyInfoPage: 1,      keyInfoPageSize: 10,    };  },  watch: {    taskStages(data) {      const TaskList = [];      for (const i in data) {        if (!TaskList.includes(data[i].task)) {          TaskList.push(data[i].task);          const taskPlanHour = data[i].plan_hour;          const splicedList = taskPlanHour.split(':');          const intPlanHour = parseInt(splicedList[0]);          let intPlanMin = parseInt(splicedList[1]);          if (intPlanHour > 0) {            intPlanMin = intPlanMin + intPlanHour * 60;          }          this.taskList.push({            id: data[i].task,            algorithm: data[i].algorithm,            employees: [data[i].employee],            plan_min: intPlanMin,          });        } else {          const dataPlanTime = data[i].plan_hour;          const splicedList = dataPlanTime.split(':');          const dataPlanHour = parseInt(splicedList[0]);          let dataPlanMin = parseInt(splicedList[1]);          if (dataPlanHour > 0) {            dataPlanMin = dataPlanMin + dataPlanHour * 60;          }          for (const j in this.taskList) {            if (this.taskList[j].id === data[i].task) {              const intPlanMin = this.taskList[j].plan_min;              dataPlanMin += intPlanMin;              this.taskList[j].plan_min = dataPlanMin;              this.taskList[j].employees.push(data[i].employee);            }          }        }      }      this.getTaskInfoByIds({ ids: TaskList });    },    taskNameList(data) {      if (this.taskList) {        for (const i in this.taskList) {          for (const j in data) {            if (this.taskList[i].id === data[j].id) {              this.taskList[i].task_name = data[j].name;              this.taskList[i].task_code = data[j].code;              this.taskList[i].end_date = data[j].end_date;              this.taskList[i].start_date = data[j].start_date;            }          }          this.taskList[i].employees = this.taskList[i].employees.filter(            this.onlyUnique          );        }        if (this.mounted) {          this.isLoaded = !this.isLoaded;        }      }    },    isLoaded() {      let heavyTask = this.taskList[0];      let longTask = this.taskList[0];      let tangledTask = this.taskList[0];      let tangleLength = 0;      let longestDuration = 0;      const Algorithms = [];      for (const i in this.taskList) {        if (tangledTask.employees.length < this.taskList[i].employees.length) {          tangleLength = this.taskList[i].employees.length;          tangledTask = this.taskList[i];        }        if (heavyTask.plan_min < this.taskList[i].plan_min) {          heavyTask = this.taskList[i];        }        const numberOfDays = Math.floor(          (new Date() - new Date(longTask.start_date)) / (24 * 60 * 60 * 1000)        );        const numberOfDays2 = Math.floor(          (new Date() - new Date(this.taskList[i].start_date)) /            (24 * 60 * 60 * 1000)        );        if (numberOfDays < numberOfDays2) {          longTask = this.taskList[i];          longestDuration = numberOfDays2;        } else {          longestDuration = numberOfDays;        }        if (this.taskList[i].algorithm) {          Algorithms.push({ id: this.taskList[i].algorithm });        }      }      const usedAlgorithms = {};      Algorithms.forEach(function (x) {        usedAlgorithms[x.id] = (usedAlgorithms[x.id] || 0) + 1;      });      for (const i in usedAlgorithms) {        const jsonData = {};        jsonData.id = i;        jsonData.data = usedAlgorithms[i];        this.usedAlgorithms.push(jsonData);      }      let planMin = parseInt(heavyTask.plan_min);      let planHour = 0;      if (planMin >= 60) {        planHour = Math.floor(planMin / 60);        planMin = planMin - 60 * planHour;      }      if (!planHour.toString().charAt(1)) {        planHour = '0' + planHour;      }      if (!planMin.toString().charAt(1)) {        planMin = '0' + planMin;      }      let demandAlgorithm = this.usedAlgorithms[0];      for (const i in this.usedAlgorithms) {        if (demandAlgorithm.data < this.usedAlgorithms[i].data) {          demandAlgorithm = this.usedAlgorithms[i];        }      }      const algorithms = this.$store.getters.company.algorithm;      for (const i in algorithms) {        if (algorithms[i].id === parseInt(demandAlgorithm.id)) {          demandAlgorithm.name = algorithms[i].name;        }      }      heavyTask.data = planHour + ':' + planMin;      this.heavyTask = heavyTask;      longTask.data = longestDuration;      this.longTask = longTask;      if (this.$route.params.type !== 'employee') {        tangledTask.data = tangleLength;        this.tangledTask = tangledTask;      }      this.demandAlgorithm = demandAlgorithm;    },  },  beforeMount() {    this.getWeeklyReport();    const week = this.getWeek(this.$route.params.weekId).split('/');    const startDate = week[0];    const endDate = week[1];    const activeCompany = this.$store.getters.activeCompany;    let type = null;    let typeDate = null;    if (this.$route.params.type === 'employee') {      type = 'executing_employee';      typeDate = this.$store.getters.user.partner_id;    } else if (this.$route.params.type === 'department') {      type = 'department_id';      typeDate = this.$route.params.id;    } else {      type = 'organization';      typeDate = this.$route.params.id;    }    const params = `${activeCompany}/?created_date__gte=${startDate}&created_date__lte=${endDate}&${type}=${typeDate}&active=1&task_state=confirm`;    this.getTaskByOrgId(params);  },  methods: {    keyInfoPageChange(page_size) {      this.keyInfoPageSize = page_size;      if (this.keyInfoMenu === 'seeAll') {        this.seeAll(this.keyInfoPage);      } else if (this.keyInfoMenu === 'issue') {        this.issues(this.keyInfoPage);      } else if (this.keyInfoMenu === 'achievements') {        this.achievements(this.keyInfoPage);      }      // const urlParam = `${this.weekDate}/?${this.$route.params.type}=${this.$route.params.id}&page=${this.keyInfoPage}&page_size=${page_size}`;      // this.getDashboardCrucialInfo(urlParam, false);    },    keyInfoPagination(page) {      this.keyInfoPage = page;      if (this.keyInfoMenu === 'seeAll') {        this.seeAll(page);      } else if (this.keyInfoMenu === 'issue') {        this.issues(page);      } else if (this.keyInfoMenu === 'achievements') {        this.achievements(page);      }      // const urlParam = `${this.weekDate}/?${this.$route.params.type}=${this.$route.params.id}&page=${page}&page_size=${this.keyInfoPageSize}`;      // this.getDashboardCrucialInfo(urlParam, false);    },    taskPage(page_size) {      this.nextWeekPlanPageSize = page_size;      if (this.nextWeekPlanMenu === 'seeAllTask') {        this.seeAllTask(this.nextWeekPlanPage);      } else if (this.nextWeekPlanMenu === 'dueNextWeek') {        this.dueNextWeek(this.nextWeekPlanPage);      } else if (this.nextWeekPlanMenu === 'startNextWeek') {        this.startNextWeek(this.nextWeekPlanPage);      }      // const urlParam = `${this.weekNumber}/?${this.$route.params.type}=${this.$route.params.id}&page=${this.nextWeekPlanPage}&page_size=${page_size}`;      // this.getDashboardCrucialInfoTask(urlParam, false);    },    taskPagination(page) {      this.nextWeekPlanPage = page;      if (this.nextWeekPlanMenu === 'seeAllTask') {        this.seeAllTask(page);      } else if (this.nextWeekPlanMenu === 'dueNextWeek') {        this.dueNextWeek(page);      } else if (this.nextWeekPlanMenu === 'startNextWeek') {        this.startNextWeek(page);      }      // const urlParam = `${this.weekNumber}/?${this.$route.params.type}=${this.$route.params.id}&page=${page}&page_size=${this.nextWeekPlanPageSize}`;      // this.getDashboardCrucialInfoTask(urlParam, false);    },    async getDashboardCrucialInfo(param, mounted = true) {      const response = await this.$store.dispatch(        'getDashboardCrucialInfo',        param      );      if (response.status === 200) {        this.conflicts = [];        this.conflicts = response.data.results;        this.keyInfoCount = response.data.total;        if (mounted) {          this.getListSortByEmployee(this.conflicts, this.conflict);          const achievmentList = [];          for (const i in this.conflicts) {            if (this.conflicts[i].point > 0) {              achievmentList.push(this.conflicts[i]);            }          }          if (achievmentList.length > 0) {            this.getListSortByEmployee(achievmentList, this.achievementMaster);            this.achievementMaster.data = '+' + this.achievementMaster.data;          }        }      }    },    async getDashboardCrucialInfoTask(param, mounted = true, is_due = false) {      const response = await this.$store.dispatch(        'getDashboardCrucialInfoTask',        param      );      if (response.status === 200) {        if (is_due) {          this.dashboard.Due_task_next_week.state = response.data.total + '';        } else {          this.taskStages = [];          const tasks = response.data.results;          this.nextWeekPlanCount = response.data.total;          this.nextWeekPlanPage = response.data.page;          for (const i in tasks) {            for (const j in tasks[i].task_stages) {              this.taskStages.push(tasks[i].task_stages[j]);            }          }          if (mounted) {            this.getMultiTaskKing(this.taskStages, 'task', this.multiTask);            this.getMultiTaskKing(              this.taskStages,              'taskStage',              this.multiStage            );          } else {            this.mounted = false;          }        }      }    },    async getTaskByOrgId(param) {      const response = await this.$store.dispatch('getTaskByOrgId', param);      if (response.status === 200) {        this.thisWeekTasks = response.data.results;        this.dashboard.New_task_created = response.data.total;      }    },    async getTaskInfoByIds(param) {      const response = await this.$store.dispatch('getTaskInfoByIds', param);      if (response.status === 200) {        this.taskNameList = response.data.return_data;      }    },    getWeeklyReport() {      const weekId = this.$route.params.weekId;      let weekYear = parseInt(weekId.split('-')[0]);      let weekNumber = parseInt(weekId.split('-')[1]) + 1;      if (weekNumber > 53) {        weekNumber = 1;        weekYear += 1;      }      this.weekDate = this.getWeek(weekId);      this.weekNumber = weekYear + '/' + weekNumber;      const urlParam = `${this.$route.params.type}=${this.$route.params.id}&page=${this.nextWeekPlanPage}&page_size=${this.nextWeekPlanPageSize}`;      const urlPath1 = this.weekDate + '/?' + urlParam;      const urlPath2 = this.weekNumber + '/?' + urlParam;      this.getDashboardCrucialInfo(urlPath1);      this.getDashboardCrucialInfoTask(urlPath2);      const param = `${this.weekNumber}/?${this.$route.params.type}=${this.$route.params.id}&page=1&page_size=1&is_due=True`;      this.getDashboardCrucialInfoTask(param, false, true);    },    onlyUnique(value, index, self) {      return self.indexOf(value) === index;    },    getWeek(data) {      const array = data.toString().split('-');      const year = array[0];      const week = array[1];      const d = week * 7;      const date = new Date(year, 0, d);      const day = date.getDay();      const diff = date.getDate() - day + (day === 0 ? -6 : 1);      const first = new Date(date.setDate(diff)).getDate();      const last = first + 6;      const firstday = new Date(date.setDate(first)).toUTCString();      const lastday = new Date(date.setDate(last)).toUTCString();      return this.formatDate(firstday) + '/' + this.formatDate(lastday);    },    formatDate(date) {      const d = new Date(date);      let month = '' + (d.getMonth() + 1);      let day = '' + d.getDate();      const year = d.getFullYear();      if (month.length < 2) month = '0' + month;      if (day.length < 2) day = '0' + day;      return [year, month, day].join('-');    },    seeAllTask(page = false) {      this.nextWeekPlanMenu = 'seeAllTask';      if (typeof page === 'number') {        this.nextWeekPlanPage = page;      } else {        this.nextWeekPlanPage = 1;      }      const urlParam = `${this.$route.params.type}=${this.$route.params.id}&page=${this.nextWeekPlanPage}&page_size=${this.nextWeekPlanPageSize}`;      const urlPath2 = this.weekNumber + '/?' + urlParam;      this.getDashboardCrucialInfoTask(urlPath2, false);    },    dueNextWeek(page = false) {      this.nextWeekPlanMenu = 'dueNextWeek';      if (typeof page === 'number') {        this.nextWeekPlanPage = page;      } else {        this.nextWeekPlanPage = 1;      }      const urlParam = `${this.weekNumber}/?${this.$route.params.type}=${this.$route.params.id}&page=${this.nextWeekPlanPage}&page_size=${this.nextWeekPlanPageSize}&is_due=True`;      this.getDashboardCrucialInfoTask(urlParam, false);    },    startNextWeek(page = false) {      this.nextWeekPlanMenu = 'startNextWeek';      const date = this.weekDate.split('/');      if (typeof page === 'number') {        this.nextWeekPlanPage = page;      } else {        this.nextWeekPlanPage = 1;      }      const urlParam = `${this.$route.params.type}=${this.$route.params.id}&page=${this.nextWeekPlanPage}&page_size=${this.nextWeekPlanPageSize}&start_date__gte=${date[0]}&start_date__lte=${date[1]}`;      const urlPath2 = this.weekNumber + '/?' + urlParam;      this.getDashboardCrucialInfoTask(urlPath2, false);    },    seeAll(page = false) {      this.keyInfoMenu = 'seeAll';      if (typeof page === 'number') {        this.keyInfoPage = page;      } else {        this.keyInfoPage = 1;      }      const urlParam = `${this.weekDate}/?${this.$route.params.type}=${this.$route.params.id}&page=${this.keyInfoPage}&page_size=${this.keyInfoPageSize}`;      this.getDashboardCrucialInfo(urlParam, false);    },    issues(page = false) {      if (typeof page === 'number') {        this.keyInfoPage = page;      } else {        this.keyInfoPage = 1;      }      this.keyInfoMenu = 'issues';      this.keyInfoPage = 1;      const urlParam = `${this.weekDate}/?${this.$route.params.type}=${this.$route.params.id}&page=${this.keyInfoPage}&page_size=${this.keyInfoPageSize}&conflict_category__exact=achievement`;      this.getDashboardCrucialInfo(urlParam, false);    },    achievements(page = false) {      this.keyInfoMenu = 'achievements';      if (typeof page === 'number') {        this.keyInfoPage = page;      } else {        this.keyInfoPage = 1;      }      const urlParam = `${this.weekDate}/?${this.$route.params.type}=${this.$route.params.id}&page=${this.keyInfoPage}&page_size=${this.keyInfoPageSize}&conflict_category=achievement`;      this.getDashboardCrucialInfo(urlParam, false);    },    getListSortByEmployee(list, data) {      const List = [];      list.forEach(function (x) {        List[x.employee] = (List[x.employee] || 0) + 1;      });      let sortedList = [];      for (let i in List) {        sortedList.push({ id: i, count: List[i] });      }      sortedList.sort(function (a, b) {        return a.count - b.count;      });      data.data = sortedList[sortedList.length - 1].count;      for (const i in sortedList) {        if (sortedList[i].count === data.data) {          data.employees.push(parseInt(sortedList[i].id));        }      }    },    getMultiTaskKing(list, type, data) {      let sortingTask = [];      if (type === 'task') {        sortingTask = Object.values(          list.reduce((a, { employee, task }) => {            if (!a[task]) a[task] = { task, employee };            return a;          }, [])        );      } else if (type === 'taskStage') {        for (const i in list) {          if (list[i].is_assigned) {            sortingTask.push(list[i]);          }        }      }      let task = [];      sortingTask.forEach(function (x) {        task[x.employee] = (task[x.employee] || 0) + 1;      });      let sortedTask = [];      for (let i in task) {        sortedTask.push({ id: i, count: task[i] });      }      sortedTask.sort(function (a, b) {        return a.count - b.count;      });      console.log(sortedTask);      data.data = sortedTask[sortedTask.length - 1].count;      for (const i in sortedTask) {        if (sortedTask[i].count === data.data) {          data.employees.push(parseInt(sortedTask[i].id));        }      }    },  },};</script><style scoped>.highlight-title {  font-weight: bold;  height: 19px;  font-size: 16px;}.highlight-value {  font-size: 24px;  line-height: 29px;  color: red;}.txt {  font-size: 12px;}.highlight {  position: absolute;  text-overflow: ellipsis;  display: -webkit-box;  -webkit-line-clamp: 3;  -webkit-box-orient: vertical;  bottom: 0;}.highlight:hover {  text-overflow: unset;}.highlight-more {  font-size: 20px;  color: white;}.more {  background: linear-gradient(180deg, #7cb4f9 0%, #6da2e4 100%);}.media-body {  height: 168px;}.highlight-card {  max-width: 230px;  width: 230px;}.trophy-card {  max-width: 184px;  width: 190px;}</style>