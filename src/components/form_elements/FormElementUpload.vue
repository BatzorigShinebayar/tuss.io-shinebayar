<template>  <el-form-item    :label="currentField.label"    :label-width="currentField.labelWidth + 'px'"  >    <el-upload      :action="currentField.uploadURL"      :on-remove="handleRemove"      :before-remove="beforeRemove"      :limit="1"      :file-list="fileList"      :auto-upload="false"      :on-preview="handlePreview"      :on-change="onUploadChange"      :on-progress="handleProgress"    >      <el-button        slot="trigger"        size="small"        type="primary"        :disabled="currentField.disabled"        >Файл хавсаргах      </el-button>      <el-button        style="margin-left: 10px"        size="small"        type="success"        :disabled="uploadButton"        @click="submitUpload"        >Илгээх      </el-button>      <div slot="tip" class="el-upload__tip">        <strong>jpg | png | pdf | docx | xlsx</strong> төрлийн        <strong>10MB</strong>-аас ихгүй хэмжээтэй файл хавсаргана.        {{ uploadPerc }}%      </div>    </el-upload>    <div v-if="img_url !== ''">      <router-link :to="img_url" target="_blank">Үзэх</router-link>    </div>  </el-form-item></template><script>import functions from '@/plugins/formFunctions';export default {  name: 'Upload',  props: {    currentField: {      type: Object,      default: null,    },  },  data() {    return {      token: this.$store.getters.token,      fileList: [],      reader: null,      fileType: '',      uploadPerc: 0,      uploadButton: true,      img_url: '',    };  },  mounted() {    if (      typeof this.currentField.entry !== 'undefined' &&      this.currentField.entry !== ''    ) {      this.fileList.push({        name: this.currentField.entry,        url: this.currentField.entry,      });      this.currentField.disabled = true;    }  },  methods: {    check_token: functions.checkToken,    async submitUpload() {      if (this.check_token()) {        const body = {          organization: this.$store.org_id.toString(),          file: this.reader.result,          type: this.fileType,        };        await fetch(this.$store.form_upload, {          method: 'POST',          headers: {            'Content-Type': 'multipart/form-data',            Authorization: this.token,          },          onUploadProgress: function (progressEvent) {            // TODO PERCENTAGE            this.uploadPerc = parseInt(              Math.round((progressEvent.loaded * 100) / progressEvent.total)            );          }.bind(this),          body: JSON.stringify(body),        })          .then((response) => response.json())          .then((data) => this.successUploaded(data))          .catch((error) => {            console.error('Error : ', error);            this.$message.error('Унших үед алдаа гарлаа!');          });      } else {        this.$message.error('Та системээс гарсан байна!');      }    },    onUploadChange(file) {      this.fileType = file.name.split('.').pop().toLowerCase();      const isIMAGE =        this.fileType === 'jpg' || 'png' || 'pdf' || 'docx' || 'xlsx';      if (!isIMAGE) {        this.$message.warning('Файлын төрөл буруу байна!');        return false;      }      const isLt1M = file.size / 1024 / 1024 < 10;      if (!isLt1M) {        this.$message.warning('10MB-аас ихгүй хэмжээтэй файл хавсаргана уу!');        return false;      }      this.reader = new FileReader();      this.reader.readAsDataURL(file.raw);      this.currentField.disabled = true;      this.uploadButton = false;    },    handleProgress(ev, file, fileLIst) {      console.log(file.raw.status);      file.raw.status = 'uploading';      console.log(ev);      console.log(file);      console.log(fileLIst);    },    async handleRemove(file, fileList) {      if (this.check_token()) {        const body = {          organization: this.$store.org_id.toString(),          name: file.name,        };        await fetch(this.$store.form_upload, {          method: 'DELETE',          headers: {            'Content-Type': 'multipart/form-data',            Authorization: this.token,          },          body: JSON.stringify(body),        })          .then((response) => {            if (response.status === 200) {              fileList.pop();              this.currentField.entry = '';              this.bs64_img = null;              this.currentField.disabled = false;              this.uploadButton = true;              this.$message.success('Амжилттай устгагдлаа');            } else {              this.$message.error('Утсгах үед алдаа гарлаа!');            }          })          .catch((error) => {            console.error('Error : ', error);            this.$message.error('Унших үед алдаа гарлаа!');          });      } else {        this.$message.error('Та системээс гарсан байна!');      }    },    async handlePreview(file) {      if (this.check_token()) {        await fetch(          this.$store.form_upload +            '?org=' +            this.$store.org_id +            '&name=' +            file.name,          {            method: 'GET',            headers: {              'Content-Type': 'multipart/form-data',              Authorization: this.token,            },          }        )          .then((response) => response.json())          .then((data) => (this.img_url = data.url))          .catch((error) => {            console.error('Error : ', error);            this.$message.error('Унших үед алдаа гарлаа!');          });      } else {        this.$message.error('Та системээс гарсан байна!');      }    },    beforeRemove(file, fileList) {      console.log(fileList);      return this.$confirm(        `Та ${file.name} файлыг устгахдаа итгэлтэй байна уу?`      );    },    successUploaded(data) {      this.currentField.entry = data.name;      this.fileList.pop();      this.fileList.push({ name: data.name, url: data.url });      this.uploadButton = true;      this.$message.success('Амжилттай илгээгдлээ!');    },  },};</script>