<template>  <b-sidebar    id="create-function"    title="Add Function"    class="sidebar-md"    right    shadow    backdrop    lazy  >    <div class="p-3">      <b-form>        <p class="mt-2 mb-4">          <b-form-group            v-if="functions"            label="Choose function type"            label-for="type"          >            <treeselect              id="type"              v-model="func"              :options="functions"              placeholder="- choose -"              @select="functionChange"            ></treeselect>          </b-form-group>        </p>        <b-form-group label="Code" label-for="add-function-code">          <b-form-input            id="add-function-code"            v-model="code"            type="text"          ></b-form-input>          <span v-if="!this.$v.code.required && formSubmit" class="text-danger">            Code is required          </span>        </b-form-group>        <b-form-group label="Function Name" label-for="add-function-name">          <b-form-input            id="add-function-name"            v-model="name"            type="text"          ></b-form-input>          <span v-if="!this.$v.name.required && formSubmit" class="text-danger">            Function Name is required          </span>        </b-form-group>        <b-form-group          label="Function Sequence"          label-for="add-function-sequence"        >          <b-form-input            id="add-function-sequence"            v-model="sequence"            type="number"          ></b-form-input>        </b-form-group>      </b-form>    </div>    <template #footer="{ hide }">      <div class="m-3">        <b-button          type="submit"          variant="deep-blue"          block          size="lg"          @click="createFunction(hide)"          >Add        </b-button>      </div>    </template>  </b-sidebar></template><script>import { required } from 'vuelidate/lib/validators';import Treeselect from '@riophae/vue-treeselect';export default {  name: 'CreateFunction',  components: {    Treeselect,  },  props: {    functionInfo: {      type: [Array, Object],      default() {        return [];      },    },  },  data() {    return {      name: null,      code: null,      formSubmit: false,      functions: null,      func: null,      sequence: 0,    };  },  validations: {    name: { required },    code: { required },  },  watch: {    functionInfo(data) {      this.treeSelectData(data);    },  },  mounted() {},  methods: {    functionChange(data) {      let func = [];      for (const i in this.functionInfo) {        if (this.functionInfo[i].id === data.id) {          func = this.functionInfo[i].functions;        }      }      this.sequence = func[func.length - 1].sequence + 1;    },    treeSelectData(data) {      const changingData = data;      const targetData = [];      for (const i in changingData) {        const jsonData = {};        jsonData.id = changingData[i].id;        jsonData.label = changingData[i].name;        targetData.push(jsonData);      }      this.functions = targetData;    },    async createFunction(hide) {      this.formSubmit = true;      this.$v.$touch();      if (!this.$v.$invalid) {        const organization_id = this.$store.getters.activeCompany;        const grp = this.$store.getters.user.companies;        let group_id = null;        for (const i in grp) {          if (parseInt(grp[i].organization_id) === parseInt(organization_id)) {            group_id = grp[i].group_id;          }        }        const jsonData = {          organization_id: organization_id,          group_id: group_id,          name: this.name,          code: this.code,          function_type_id: this.func,          created_user: this.$store.getters.user.id,          updated_user: this.$store.getters.user.id,          created_date: new Date(),          updated_date: new Date(),          sequence: this.sequence,        };        const params = {          urlParam: '',          urlData: jsonData,        };        // console.log('params', params);        const response = await this.$store.dispatch('postFunction', params);        if (response.status === 200) {          hide();          this.$root.$emit('bv::show::modal', 'function-modal');          this.$emit('reload', true);        }      }    },  },};</script>