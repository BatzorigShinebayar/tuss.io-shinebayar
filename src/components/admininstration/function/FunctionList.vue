<template>  <div v-if="functions">    <div class="mt-3">      <div v-for="funcType of functions" :key="funcType.id">        <h4 class="font-weight-bold mb-3">{{ funcType.name }}</h4>        <div v-for="func of funcType.functions" :key="func.code">          <div class="d-flex align-items-center mb-3">            <h4 class="mr-3">              <b-badge variant="deep-blue">{{ func.code }}</b-badge>            </h4>            <p class="w-100">{{ func.name }}</p>            <div class="w-100">              <a                class="float-right cursor-pointer"                @click="editFuntion(func)"                v-if="funcUpd"              >                <Fa :icon="['fas', 'cog']" />              </a>            </div>          </div>          <div class="row mb-3">            <div              v-for="sub of func.sub_function"              :key="sub.id"              class="col-lg-4 mb-4"            >              <div class="sub-function">                <h5 class="font-weight-bold mb-2">{{ sub.code }}</h5>                <p>{{ sub.name }}</p>                <a                  class="edit-icon"                  @click="editSubFuntion(sub)"                  v-if="funcUpd"                >                  <Fa :icon="['fas', 'cog']" />                </a>              </div>            </div>            <div class="col-lg-4 mb-4">              <div                class="sub-function-add align-items-center"                @click="createSubFuntion(func)"                v-if="funcCrt"              >                <h4>                  <Fa :icon="['fas', 'plus']" />                  Add sub function                </h4>              </div>            </div>          </div>        </div>      </div>      <div class="col-lg-12 mb-4">        <div          class="sub-function-add align-items-center"          v-if="funcCrt"          @click="createFuntion()"        >          <h4>            <Fa :icon="['fas', 'plus']" />            Add function          </h4>        </div>      </div>    </div>    <CreateFunction :function-info="functions" @reload="getFunction" />    <CreateSubFunction :function-info="functionInfo" @reload="getFunction" />    <SubFunctionEdit :function-edit="functionEdit" @reload="getFunction" />    <FunctionEdit :function-edit="functionsEdit" @reload="getFunction" />    <FunctionModal />  </div></template><script>import CreateFunction from '@/components/admininstration/function/CreateFunction';import CreateSubFunction from '@/components/admininstration/function/CreateSubFunction';import FunctionModal from '@/components/admininstration/function/FunctionModal';import SubFunctionEdit from '@/components/admininstration/function/SubFunctionEdit';import FunctionEdit from '@/components/admininstration/function/FunctionEdit';export default {  name: 'FunctionList',  components: {    CreateSubFunction,    SubFunctionEdit,    CreateFunction,    FunctionModal,    FunctionEdit,  },  data() {    return {      functionType: [],      functions: [],      functionInfo: [],      functionEdit: [],      functionsEdit: [],      funcRed: this.permission('func_red'),      funcCrt: this.permission('func_crt'),      funcUpd: this.permission('func_upd'),    };  },  beforeMount() {    this.functionType = this.$store.getters.company.function_type;    this.getFunction();  },  methods: {    async getFunction() {      const params = `?page_size=10000&organization=${this.$store.getters.activeCompany}`;      const response = await this.$store.dispatch('getFunction', params);      if (response.status === 200) {        this.functions = [];        const company = this.$store.getters.company;        company.function = response.data.results;        for (const i in company.function) {          if (company.function[i].sub_functions) {            company.function[i].sub_function =              company.function[i].sub_functions;            delete company.function[i].sub_functions;          }        }        await this.$store.commit('company', company);        for (const i in this.functionType) {          const functions = [];          const jsonData = {            id: this.functionType[i].id,            name: this.functionType[i].name,            code: this.functionType[i].code,            sequence: this.functionType[i].sequence,            functions: [],          };          this.functions.push(jsonData);          for (const func of response.data.results) {            if (              parseInt(func.function_type) ===                parseInt(this.functionType[i].id) &&              func.is_active === '1'            ) {              const jsonData = {                id: func.id,                name: func.name,                code: func.code,                function_type: func.function_type,                sequence: func.sequence,                sub_function: [],              };              for (const subFunc of func.sub_function) {                if (subFunc.is_active === '1') {                  jsonData.sub_function.push(subFunc);                }              }              functions.push(jsonData);            }          }          this.functions[i].functions = functions;        }      }    },    editFuntion(info) {      this.$root.$emit('bv::toggle::collapse', 'edit-function');      this.functionsEdit = info;    },    createFuntion() {      this.$root.$emit('bv::toggle::collapse', 'create-function');    },    createSubFuntion(info) {      this.$root.$emit('bv::toggle::collapse', 'create-sub-function');      this.functionInfo = info;    },    editSubFuntion(sub) {      this.functionEdit = sub;      this.$root.$emit('bv::toggle::collapse', 'edit-sub-function');    },  },};</script>