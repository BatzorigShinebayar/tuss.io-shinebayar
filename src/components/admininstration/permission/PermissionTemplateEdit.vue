<template>  <div>    <div class="p-4">      <ContentHeader>        <template #text>          <h4 class="font-weight-bold mb-3">            {{ type === 'create' ? 'Creating new' : 'Edit your' }} permission            template!          </h4>          <p>            Please input required information below to            {{ type === 'create' ? 'creating new' : 'edit your' }}            permission template to your company.          </p>        </template>        <template #image>          <img            id="astronaut"            src="@/assets/images/background/astronaut2.png"            alt="astronaut"          />        </template>      </ContentHeader>      <b-form class="d-block mt-3">        <b-form-group label="Permission template name" label-for="name">          <b-form-input            id="name"            v-model="sideBarData.name"            type="text"            @change="changeName"            required          ></b-form-input>          <p id="name_warning_" style="display: none" class="color-red">            Please insert permission template name!          </p>        </b-form-group>      </b-form>      <b-col class="my-buttons" cols="12">        <b-form-group          v-for="(item, key) in contentActions"          :key="key"          :label="key"        >          <b-form-checkbox            v-for="(action, index) in item"            :key="index"            v-model="sideBarData.data[action.code]"            class="mb-2 tus-check-btn d-inline-block"            name="check-button"            @change="toggleAction(action, sideBarData.data[action.code])"          >            {{ action.code }}          </b-form-checkbox>        </b-form-group>      </b-col>    </div>    <b-col cols="12" class="d-flex bg-secondary py-3 footer">      <b-col cols="10">        <b-button v-if="type === 'create'" variant="deep-blue" @click="create">          Create        </b-button>        <b-button v-else variant="deep-blue" @click="update" block>          Update        </b-button>      </b-col>      <b-col cols="2">        <b-button @click="hide" variant="outline-dark" block> Close </b-button>      </b-col>    </b-col>  </div></template><script>import ContentHeader from '@/components/admininstration/ContentHeader';export default {  name: 'PermissionTemplateEdit',  components: { ContentHeader },  props: {    type: {      type: String,      default() {        return '';      },    },    data: {      type: Object,      default: null,    },  },  data() {    return {      sideBarData: { name: '', data: {}, is_data: false },      contentActionsRaw: [],      contentActions: {        ach1: [],        ach2: [],        ach4: [],        acpn: [],        algr: [],        atte: [],        conf: [],        dept: [],        empl: [],        func: [],        ince: [],        jbtt: [],        orga: [],        prms: [],        regu: [],        rule: [],        slry: [],        task: [],        tj10: [],      },      permissionTemplateCA: null,      sendDataCreate: [],      sendDataUpdate: [],      sendDataTemplateCA: [],    };  },  watch: {    contentActionsRaw() {      if (this.type === 'edit') {        const params = `?is_active=1&page_size=1000&template=      ${this.data.item.id}`;        this.getPermissionTemplateContentaction(params);      } else {        this.permissionTemplateCA = [];      }    },    permissionTemplateCA(data) {      for (const i in this.contentActionsRaw) {        // this.sideBarData.data[this.contentActionsRaw[i].code] = false;        for (const j in data) {          if (this.contentActionsRaw[i].id === data[j].content_action) {            this.sendDataTemplateCA.push(this.contentActionsRaw[i].code);            this.sideBarData.data[this.contentActionsRaw[i].code] = true;          }        }        if (this.contentActionsRaw[i].code.includes('ach1')) {          this.contentActions.ach1.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('ach2')) {          this.contentActions.ach2.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('ach4')) {          this.contentActions.ach4.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('acpn')) {          this.contentActions.acpn.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('algr')) {          this.contentActions.algr.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('atte')) {          this.contentActions.atte.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('conf')) {          this.contentActions.conf.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('dept')) {          this.contentActions.dept.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('empl')) {          this.contentActions.empl.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('func')) {          this.contentActions.func.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('ince')) {          this.contentActions.ince.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('jbtt')) {          this.contentActions.jbtt.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('orga')) {          this.contentActions.orga.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('prms')) {          this.contentActions.prms.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('regu')) {          this.contentActions.regu.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('rule')) {          this.contentActions.rule.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('slry')) {          this.contentActions.slry.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('task')) {          this.contentActions.task.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('tj10')) {          this.contentActions.tj10.push(this.contentActionsRaw[i]);        }      }      this.sideBarData.is_data = !this.sideBarData.is_data;    },  },  beforeMount() {    if (this.type === 'edit') {      this.sideBarData.name = this.data.item.name;    }    const params = `?is_active=1&page_size=1000&organization=      ${this.$store.getters.activeCompany}`;    this.getContentAction(params);  },  methods: {    hide() {      this.$root.$emit('bv::toggle::collapse', 'sideBarPermTemp');    },    async changeName(data) {},    async updatePermissionTemplate(params) {      const response = await this.$store.dispatch(        'updatePermissionTemplate',        params      );    },    async toggleAction(item, value) {      let isActive = 0;      if (value) {        isActive = '1';      }      if (this.type === 'edit') {        let checkCreate = false;        const templateId = this.data.item.id;        const params = `?page_size=1000&template=        ${templateId}`;        const response = await this.getPermissionTemplateContentaction(          params,          true        );        if (response) {          const responseData = response.results;          for (const i in responseData) {            if (responseData[i].content_action === item.id) {              checkCreate = true;              let check = false;              for (const j in this.sendDataUpdate) {                if (this.sendDataUpdate[j].content_action_id === item.id) {                  this.sendDataUpdate[j].is_active = isActive;                  this.sendDataUpdate[j].updated_user =                    this.$store.getters.user.id;                  check = true;                }              }              if (!check) {                this.sendDataUpdate.push({                  id: responseData[i].id,                  is_active: isActive,                  updated_user: this.$store.getters.user.id,                });              }            }          }        }        if (!checkCreate) {          const jsonData = {            content_action_id: item.id,            template_id: templateId,            created_user: this.$store.getters.user.id,            updated_user: this.$store.getters.user.id,            is_active: isActive,          };          this.sendDataCreate.push(jsonData);        }      } else {        const jsonData = {          content_action_id: item.id,          template_id: '',          created_user: this.$store.getters.user.id,          updated_user: this.$store.getters.user.id,          is_active: isActive,        };        this.sendDataCreate.push(jsonData);      }    },    async getPermissionTemplateContentaction(params, all = false) {      const response = await this.$store.dispatch(        'getPermissionTemplateContentaction',        params      );      if (response.status === 200) {        if (all) {          return response.data;        } else {          this.permissionTemplateCA = response.data.results;        }      }    },    async getContentAction(params) {      const response = await this.$store.dispatch('getContentAction', params);      if (response.status === 200) {        this.contentActionsRaw = response.data.results;      }    },    async postPermissionTemplate(params) {      const response = await this.$store.dispatch(        'postPermissionTemplate',        params      );      if (response.status === 200) {        return response.data;      }    },    async postPermissionTemplateContentaction(params) {      const response = await this.$store.dispatch(        'postPermissionTemplateContentaction',        params      );      if (response.status === 200) {        return true;      } else {        return false;      }    },    async create() {      if (this.sendDataCreate.length > 0 && this.sideBarData.name) {        const organizationId = this.$store.getters.activeCompany;        let groupId = null;        for (const i in this.$store.getters.user.companies) {          if (            this.$store.getters.user.companies[i].organization_id ===            organizationId          ) {            groupId = this.$store.getters.user.companies[i].group_id;          }        }        const response = await this.postPermissionTemplate({          created_user: this.$store.getters.user.id,          name: this.sideBarData.name,          updated_user: this.$store.getters.user.id,          is_active: '1',          organization_id: organizationId,          group_id: groupId,        });        if (response) {          for (const i in this.sendDataCreate) {            this.sendDataCreate[i].template_id = response;            const params = {              urlParams: '',              urlData: this.sendDataCreate[i],            };            await this.postPermissionTemplateContentaction(params);          }        }      } else {        alert(          'Please set template name or activate at least 1 permission for template'        );      }    },    async update() {      let checkDone = true;      const param = {        urlParam: `${this.data.item.id}/`,        urlData: { id: this.data.item.id, name: this.sideBarData.name },      };      await this.updatePermissionTemplate(param);      for (const i in this.sendDataCreate) {        const params = {          urlParams: '',          urlData: this.sendDataCreate[i],        };        const returnData = await this.postPermissionTemplateContentaction(          params        );        if (!returnData) {          checkDone = false;        }      }      for (const i in this.sendDataUpdate) {        const params = {          urlParams: this.sendDataUpdate[i].id + '/',          urlData: this.sendDataUpdate[i],        };        const returnData = await this.postPermissionTemplateContentaction(          params        );        if (!returnData) {          checkDone = false;        }      }      if (checkDone) {        this.$root.$emit('bv::toggle::collapse', 'sideBarPermTemp');      }    },  },};</script><style scoped>#astronaut {  position: absolute;  right: 20px;  top: -17px;}</style>