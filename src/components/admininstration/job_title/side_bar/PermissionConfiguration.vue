<template>  <div>    <b-col class="my-buttons" cols="12">      <b-form-group label="Permission template" label-for="PermissionTemplate">        <multiselect          id="PermissionTemplate"          v-model="permissionTemplate"          :options="permissionTemplates"          placeholder="- Choose -"          label="name"          track-by="id"          @select="permTemplate"        ></multiselect>      </b-form-group>      <b-form-group        v-for="(item, key) in contentActions"        :key="key"        :label="key"      >        <b-form-checkbox          v-for="(action, index) in item"          :key="index"          class="mb-2 tus-check-btn d-inline-block"          :checked="sideBarData[action.code]"          name="check-button"          @change="toggleAction(action)"        >          {{ action.code }}        </b-form-checkbox>      </b-form-group>    </b-col>  </div></template><script>import Multiselect from 'vue-multiselect';export default {  name: 'GeneralInformation',  components: {    Multiselect,  },  props: {    type: {      type: String,      default() {        return '';      },    },    data: {      type: Object,      default: null,    },  },  data() {    return {      sideBarData: {},      contentActionsRaw: [],      contentActions: {        ach1: [],        ach2: [],        ach4: [],        acpn: [],        algr: [],        atte: [],        conf: [],        dept: [],        empl: [],        func: [],        ince: [],        jbtt: [],        orga: [],        prms: [],        regu: [],        rule: [],        slry: [],        task: [],        tj10: [],        tusd: [],      },      permissionTemplateCA: null,      permissionTemplates: [],      sendDataCreate: [],      sendDataUpdate: [],      sendDataTemplateCA: [],      permissionTemplate: null,      jobTitlePermission: [],      prmsRed: this.permission('prms_red'),      prmsUpd: this.permission('prms_upd'),    };  },  watch: {    // permissionTemplate(data) {    // },    jobTitlePermission(data) {      const contentActions = {        ach1: [],        ach2: [],        ach4: [],        acpn: [],        algr: [],        atte: [],        conf: [],        dept: [],        empl: [],        func: [],        ince: [],        jbtt: [],        orga: [],        prms: [],        regu: [],        rule: [],        slry: [],        task: [],        tj10: [],        tusd: [],      };      for (const i in this.contentActionsRaw) {        this.sideBarData[this.contentActionsRaw[i].code] = false;        for (const j in data) {          if (this.contentActionsRaw[i].id === data[j].content_action) {            this.sendDataTemplateCA.push(this.contentActionsRaw[i].code);            if (data[j].is_active === '1') {              this.sideBarData[this.contentActionsRaw[i].code] = true;            }          }        }        if (this.contentActionsRaw[i].code.includes('ach1')) {          contentActions.ach1.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('ach2')) {          this.contentActions.ach2.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('ach4')) {          contentActions.ach4.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('acpn')) {          contentActions.acpn.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('algr')) {          contentActions.algr.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('atte')) {          contentActions.atte.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('conf')) {          contentActions.conf.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('dept')) {          contentActions.dept.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('empl')) {          contentActions.empl.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('func')) {          contentActions.func.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('ince')) {          contentActions.ince.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('jbtt')) {          contentActions.jbtt.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('orga')) {          contentActions.orga.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('prms')) {          contentActions.prms.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('regu')) {          contentActions.regu.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('rule')) {          contentActions.rule.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('slry')) {          contentActions.slry.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('task')) {          contentActions.task.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('tj10')) {          contentActions.tj10.push(this.contentActionsRaw[i]);        }        if (this.contentActionsRaw[i].code.includes('tusd')) {          contentActions.tusd.push(this.contentActionsRaw[i]);        }      }      this.contentActions = contentActions;    },    async permissionTemplateCA(data) {      if (data.length > 0) {        this.sendDataUpdate = [];        this.sendDataCreate = [];        const contentActions = {          ach1: [],          ach2: [],          ach4: [],          acpn: [],          algr: [],          atte: [],          conf: [],          dept: [],          empl: [],          func: [],          ince: [],          jbtt: [],          orga: [],          prms: [],          regu: [],          rule: [],          slry: [],          task: [],          tj10: [],          tusd: [],        };        const listItem = [];        for (const i in this.contentActionsRaw) {          this.sideBarData[this.contentActionsRaw[i].code] = false;          for (const j in data) {            if (this.contentActionsRaw[i].id === data[j].content_action) {              this.sendDataTemplateCA.push(this.contentActionsRaw[i].code);              const jsonData = this.contentActionsRaw[i];              if (data[j].is_active === '1') {                this.sideBarData[this.contentActionsRaw[i].code] = true;                jsonData.is_active = '1';              } else {                jsonData.is_active = '0';              }              listItem.push(jsonData);            }          }          if (this.contentActionsRaw[i].code.includes('ach1')) {            contentActions.ach1.push(this.contentActionsRaw[i]);          }          if (this.contentActionsRaw[i].code.includes('ach2')) {            this.contentActions.ach2.push(this.contentActionsRaw[i]);          }          if (this.contentActionsRaw[i].code.includes('ach4')) {            contentActions.ach4.push(this.contentActionsRaw[i]);          }          if (this.contentActionsRaw[i].code.includes('acpn')) {            contentActions.acpn.push(this.contentActionsRaw[i]);          }          if (this.contentActionsRaw[i].code.includes('algr')) {            contentActions.algr.push(this.contentActionsRaw[i]);          }          if (this.contentActionsRaw[i].code.includes('atte')) {            contentActions.atte.push(this.contentActionsRaw[i]);          }          if (this.contentActionsRaw[i].code.includes('conf')) {            contentActions.conf.push(this.contentActionsRaw[i]);          }          if (this.contentActionsRaw[i].code.includes('dept')) {            contentActions.dept.push(this.contentActionsRaw[i]);          }          if (this.contentActionsRaw[i].code.includes('empl')) {            contentActions.empl.push(this.contentActionsRaw[i]);          }          if (this.contentActionsRaw[i].code.includes('func')) {            contentActions.func.push(this.contentActionsRaw[i]);          }          if (this.contentActionsRaw[i].code.includes('ince')) {            contentActions.ince.push(this.contentActionsRaw[i]);          }          if (this.contentActionsRaw[i].code.includes('jbtt')) {            contentActions.jbtt.push(this.contentActionsRaw[i]);          }          if (this.contentActionsRaw[i].code.includes('orga')) {            contentActions.orga.push(this.contentActionsRaw[i]);          }          if (this.contentActionsRaw[i].code.includes('prms')) {            contentActions.prms.push(this.contentActionsRaw[i]);          }          if (this.contentActionsRaw[i].code.includes('regu')) {            contentActions.regu.push(this.contentActionsRaw[i]);          }          if (this.contentActionsRaw[i].code.includes('rule')) {            contentActions.rule.push(this.contentActionsRaw[i]);          }          if (this.contentActionsRaw[i].code.includes('slry')) {            contentActions.slry.push(this.contentActionsRaw[i]);          }          if (this.contentActionsRaw[i].code.includes('task')) {            contentActions.task.push(this.contentActionsRaw[i]);          }          if (this.contentActionsRaw[i].code.includes('tj10')) {            contentActions.tj10.push(this.contentActionsRaw[i]);          }          if (this.contentActionsRaw[i].code.includes('tusd')) {            contentActions.tusd.push(this.contentActionsRaw[i]);          }        }        this.contentActions = contentActions;        const jobPermId = this.data.item.id;        const params = `?page_size=1000&job_title=        ${jobPermId}`;        const response = await this.getJobTitlePermission(params, true);        for (const j in response.results) {          if (response.results[j].is_active === '1') {            const jsonData = {              id: response.results[j].content_action,              code: response.results[j].code,            };            this.toggleAction(jsonData, false);          }        }        for (const j in listItem) {          let bool = false;          if (listItem[j].is_active === '1') {            bool = true;          }          this.toggleAction(listItem[j], bool);        }      }    },  },  beforeMount() {    const params = `?is_active=1&page_size=1000&organization=      ${this.$store.getters.activeCompany}`;    this.getContentAction(params);    this.getPermissionTemplate(params);  },  methods: {    permTemplate(data) {      this.permissionTemplateCA = [];      const params = `?is_active=1&page_size=1000&template=      ${data.id}`;      this.getPermissionTemplateContentaction(params);    },    async toggleAction(item, value) {      let val = null;      if (value) {        val = value;      } else {        val = event.target.checked;      }      if (this.prmsUpd) {        this.sideBarData[item.code] = val;        let isActive = 0;        if (val) {          isActive = '1';        }        let checkCreate = false;        const jobPermId = this.data.item.id;        const params = `?page_size=1000&job_title=        ${jobPermId}`;        const response = await this.getJobTitlePermission(params, true);        if (response) {          const responseData = response.results;          for (const i in responseData) {            if (responseData[i].content_action === item.id) {              checkCreate = true;              let check = false;              for (const j in this.sendDataUpdate) {                if (this.sendDataUpdate[j].content_action_id === item.id) {                  this.sendDataUpdate[j].is_active = isActive;                  this.sendDataUpdate[j].updated_user =                    this.$store.getters.user.id;                  check = true;                }              }              if (!check) {                this.sendDataUpdate.push({                  id: responseData[i].id,                  content_action_id: item.id,                  is_active: isActive,                  updated_user: this.$store.getters.user.id,                });              }            }          }          if (!checkCreate) {            const organizationId = this.$store.getters.activeCompany;            let groupId = null;            for (const i in this.$store.getters.user.companies) {              if (                this.$store.getters.user.companies[i].organization_id ===                organizationId              ) {                groupId = this.$store.getters.user.companies[i].group_id;              }            }            const jsonData = {              content_action_id: item.id,              job_title_id: jobPermId,              created_user: this.$store.getters.user.id,              updated_user: this.$store.getters.user.id,              organization_id: organizationId,              code: item.code,              group_id: groupId,              is_active: isActive,            };            this.sendDataCreate.push(jsonData);          }        }        const sendData = {          sendDataCreate: this.sendDataCreate,          sendDataUpdate: this.sendDataUpdate,        };        console.log('sendData', sendData);        this.$emit('permission_data', sendData);      }    },    async getPermissionTemplateContentaction(params, all = false) {      const response = await this.$store.dispatch(        'getPermissionTemplateContentaction',        params      );      if (response.status === 200) {        if (all) {          return response.data;        } else {          this.permissionTemplateCA = response.data.results;        }      }    },    async getContentAction(params) {      const response = await this.$store.dispatch('getContentAction', params);      if (response.status === 200) {        this.contentActionsRaw = response.data.results;        const params = `?page_size=1000&job_title=        ${this.data.item.id}`;        await this.getJobTitlePermission(params);      }    },    async getJobTitlePermission(params, all = false) {      const response = await this.$store.dispatch(        'getJobTitlePermission',        params      );      if (response.status === 200) {        if (all) {          return response.data;        } else {          this.jobTitlePermission = response.data.results;        }      }    },    async getPermissionTemplate(params) {      const response = await this.$store.dispatch(        'getPermissionTemplate',        params      );      if (response.status === 200) {        this.permissionTemplates = response.data.results;      }    },    update() {},  },};</script>