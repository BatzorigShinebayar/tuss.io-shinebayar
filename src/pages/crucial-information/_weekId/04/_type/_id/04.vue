<template>  <MainLayout>    <SubMenu>      <template #submenu>        <Searchbar          :search-items="searchItems"          :search-bar="'crucial-information'"        />      </template>    </SubMenu>    <NavBar>      <template #top>        <h4 class="p-3" style="min-width: 290px">          <img            :src="image"            onError="this.onerror=null;this.src='https://tuss.io/tusd_images/profile/human_icon.png';"            class="img-thumbnail rounded-circle mx-1"            width="41"            alt          />          {{ name | get_employee_info }}        </h4>      </template>      <template #bottom>        <div class="container-fluid" style="background-color: #ffffff">          <b-tabs v-model="tabIndex" content-class="mt-3">            <b-tab title="< Back" />            <b-tab title="This week">              <b-col cols="12">                <CIPerformanceTab />              </b-col>            </b-tab>            <b-tab title="Next week">              <CINextWeekTab />            </b-tab>            <b-tab title="Dashboard" lazy>              <CIDashboardTab />            </b-tab>            <b-tab title="Outside Information" lazy>              <COITab />            </b-tab>          </b-tabs>        </div>      </template>    </NavBar>  </MainLayout></template><script>import MainLayout from '@/components/layout/MainLayout';import NavBar from '@/components/layout/NavBar';import CIPerformanceTab from '@/components/crucial_information/CIPerformanceTab';import CINextWeekTab from '@/components/crucial_information/CINextWeekTab';import CIDashboardTab from '@/components/crucial_information/CIDashboardTab';import COITab from '@/components/crucail_outside_information/COITab';import Searchbar from '@/components/layout/SearchBar';import SubMenu from '@/components/layout/SubMenu';export default {  name: 'CrucialInformation',  components: {    MainLayout,    NavBar,    SubMenu,    Searchbar,    CIDashboardTab,    CINextWeekTab,    CIPerformanceTab,    COITab,  },  layout: 'main',  data() {    return {      tabIndex: 1,      searchItems: [        {          name: 'This week',          icon: 'calendar',          url: '',          weekNum: 0,        },      ],      name: '',      image: null,      weekNum: 0,    };  },  head() {    return {      title: 'АЧ Мэдээлэл | ТУС Д+',    };  },  watch: {    tabIndex(data) {      if (data === 3 && this.$route.query.tab !== 'dashboard') {        this.$router.replace({ query: { tab: 'dashboard' } });      } else if (data === 2 && this.$route.query.tab !== 'nextWeek') {        this.$router.replace({ query: { tab: 'nextWeek' } });      } else if (data === 0) {        this.$router.push({          path: '/crucial-information/01/',        });      } else if (this.$route.query.tab !== null) {        this.$router.replace({ query: { tab: null } });      }    },  },  beforeMount() {    if (this.$route.query.tab === 'dashboard') {      this.tabIndex = 3;    } else if (this.$route.query.tab === 'nextWeek') {      this.tabIndex = 2;    } else {      this.tabIndex = 1;    }    this.weekNum = this.$store.getters['getThisWeekId'];    const params = '?page_size=4';    this.weeklyCrucialInfoData(params);  },  mounted() {    if (this.$route.params.type === 'employee') {      const employee = this.$store.getters.company.employees;      for (const i in employee) {        if (employee[i].partner__id === parseInt(this.$route.params.id)) {          this.name = employee[i].partner__id;          this.image = employee[i].partner__picture;        }      }    } else if (this.$route.params.type === 'department') {      const department = this.$store.getters.company.department;      for (const i in department) {        if (department[i].id === parseInt(this.$route.params.id)) {          this.name = department[i].name;        }      }    } else {      const companies = this.$store.getters.user.companies;      for (const i in companies) {        if (companies[i].organization_id === parseInt(this.$route.params.id)) {          this.name = companies[i].organization;        }      }    }  },  methods: {    async weeklyCrucialInfoData(params) {      const urlPath = this.$store.getters.activeCompany + '/' + params;      const response = await this.$store.dispatch(        'getWeeklyCrucialInfo',        urlPath      );      if (response.status === 200) {        const tabMenuItem = response.data.weekly_critical_info.results;        this.searchItems = [];        for (const i in tabMenuItem) {          if (this.weekNum === tabMenuItem[i].plan_week_number) {            this.searchItems.push({              weekNum: tabMenuItem[i].plan_week_number,              name: 'This week',              weekId:                tabMenuItem[i].plan_week_year +                '-' +                tabMenuItem[i].plan_week_number,              type: 'employee',              id: this.$store.getters.user.partner_id,              url: `crucialInfo04`,              icon: 'calendar',            });          } else if (this.weekNum + 1 === tabMenuItem[i].plan_week_number) {            this.searchItems.push({              weekNum: tabMenuItem[i].plan_week_number,              name: 'Next week',              weekId:                tabMenuItem[i].plan_week_year +                '-' +                tabMenuItem[i].plan_week_number,              type: 'employee',              id: this.$store.getters.user.partner_id,              url: `crucialInfo04`,              icon: 'calendar',            });          } else {            const planStartDate = new Date(tabMenuItem[i].plan_start_date);            const planEndDate = new Date(tabMenuItem[i].plan_end_date);            const months = [              'Jan',              'Feb',              'Mar',              'Apr',              'May',              'Jun',              'Jul',              'Aug',              'Sep',              'Oct',              'Nov',              'Dec',            ];            const date1 =              months[planStartDate.getMonth()] + ' ' + planStartDate.getDate();            const date2 =              months[planEndDate.getMonth()] + ' ' + planEndDate.getDate();            this.searchItems.push({              weekNum: tabMenuItem[i].plan_week_number,              name: date1 + ' to ' + date2,              type: 'employee',              weekId:                tabMenuItem[i].plan_week_year +                '-' +                tabMenuItem[i].plan_week_number,              id: this.$store.getters.user.partner_id,              url: `crucialInfo04`,              icon: 'calendar',            });          }        }        this.searchItems.push({          weekNum: 0,          name: 'more',          url: `crucialInfo01`,          icon: '',        });      }    },  },};</script>