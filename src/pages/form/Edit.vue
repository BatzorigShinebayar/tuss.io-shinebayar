<template>  <div v-if="token !== null" id="printMe">    <div class="wrapper--forms--entry">      <el-form>        <el-row class="section-block">          <el-col :span="3">            <el-form-item label="Ажлын Код">              <el-input :value="$store.state.task_code"></el-input>            </el-form-item>          </el-col>          <el-col :span="16">            <el-form-item label="Ажлын нэр">              <el-input :value="$store.state.task_name"></el-input>            </el-form-item>          </el-col>          <el-col :span="5">            <el-form-item label="Ажлын хариуцагч нэр">              <el-input                :value="$store.state.task_employee | get_employee_info"              ></el-input>            </el-form-item>          </el-col>          <el-col :span="19">            <el-form-item label="Бүлгийн нэр">              <el-input :value="$store.state.form_name"></el-input>            </el-form-item>          </el-col>          <el-col :span="5">            <el-form-item label="Бүлгийн код">              <el-input :value="$store.state.form_code"></el-input>            </el-form-item>          </el-col>        </el-row>        <template v-for="(eachFormObj, eachFormIndex) in forms">          <div :key="`div-${eachFormIndex}`" class="section-block">            <div class="source">              <el-row>                <el-col :span="2">                  <el-input                    :value="eachFormObj.code"                    style="width: 80%; margin-top: 10px"                  ></el-input>                </el-col>                <el-col :span="17">                  <el-form-item>                    <el-input :value="eachFormObj.title"></el-input>                  </el-form-item>                </el-col>                <el-col :span="5">                  <component                    :is="eachFormObj.switch.fieldType"                    style="padding-top: 0"                    :current-field="eachFormObj.switch"                    :form-obj="eachFormObj.fields"                    :forms="forms"                    class="form__field"                  >                  </component>                </el-col>              </el-row>            </div>            <div class="meta">              <div style="margin-top: 5px; margin-bottom: 5px">                <el-button size="small" @click="addTab(eachFormObj)"                  >Хувилбар нэмэх                </el-button>              </div>              <el-tabs                v-model="eachFormObj.activeTab"                type="card"                :closable="!eachFormObj.switch.disabled"                @tab-remove="removeTab(eachFormObj, $event)"              >                <el-tab-pane                  v-for="item in eachFormObj.fields"                  :key="item.uniq"                  :label="item.title"                  :name="item.uniq"                >                  <el-row>                    <el-col                      v-for="(field, index) in item.fields"                      :key="index"                      v-bind="field"                      :span="field.span"                      class="form__group"                    >                      <div>                        <component                          :is="field.fieldType"                          :current-field="field"                          :state="eachFormObj.switch"                          class="form__field"                        >                        </component>                      </div>                    </el-col>                  </el-row>                </el-tab-pane>              </el-tabs>            </div>          </div>        </template>        <el-row>          <el-button            style="margin-bottom: 10px; float: right"            type="success"            :disabled="$store.state.submit"            @click="submitForm"            >Хадгалах          </el-button>          <el-button            style="margin-bottom: 10px; margin-right: 10px; float: right"            type="warning"            @click="print"            >Хэвлэх          </el-button>        </el-row>      </el-form>    </div>    <div>      <el-card class="box-card">        <div slot="header" class="clearfix">          <strong>Сэтгэгдэл</strong>        </div>        <div class="comments">          <div            v-for="(comment, index) in comments"            :key="index"            class="comment border-bottom flex-space-between"          >            <div class="avatar m-3">              <div>                <img                  :src="`data:image/png;base64, ` + comment.emp_img"                  onError="this.onerror=null;this.src='/tusd_images/profile/human_icon.png';"                  width="50"                  style="border-radius: 50%"                />              </div>            </div>            <div class="text align-self-center">              <label>{{ comment.emp_name }}</label> -              <i class="el-icon-alarm-clock"></i>              <small>{{ formatDate(comment.created_date) }}</small>              <p>{{ comment.text }}</p>            </div>          </div>          <div class="comment flex-space-between">            <div class="avatar m-3">              <div>                <img                  :src="`data:image/png;base64, ` + $store.state.emp_img"                  onError="this.onerror=null;this.src='/tusd_images/profile/human_icon.png';"                  width="50"                  style="border-radius: 50%"                />              </div>            </div>            <div class="text align-self-center">              <label>{{ $store.state.emp_name }}</label>              <el-input                v-model="comment_text"                type="textarea"                :rows="2"              ></el-input>              <el-button                style="margin-top: 10px; float: right"                type="primary"                @click="sendComment"              >                Илгээх              </el-button>            </div>          </div>        </div>      </el-card>    </div>  </div></template><script>import { FormBuilder } from '@/components/form_elements/formbuilder';import functions from '@/plugins/formFunctions';import axios from 'axios';export default {  name: 'Edit',  components: FormBuilder.$options.components,  data() {    return {      comment_text: '',      states: [],      entries: [],      comments: [],      token: this.$store.getters.token,      activeField: this.$store.state.activeField,      themingVars: this.$store.state.themingVars,      forms: [],    };  },  async beforeMount() {    // console.log('store', store);    await axios      .get(        this.$store.state.form_data_url +          '?id=' +          this.$route.query.did +          '&tsg=' +          this.$route.query.tsg +          '&tsk=' +          this.$route.query.tsk      )      .then((data) => {        this.set_state(data.data, 'edit');        this.forms = this.$store.state.forms;      })      .catch((error) => {        console.error('Error : ', error);        alert('Унших үед алдааs гарлаа!');      });    await axios      .get(this.$store.state.form_comment + '?id=' + this.$route.query.tsg)      .then((data) => {        this.comments = data.data;      })      .catch((error) => {        console.error('Error : ', error);        alert('Унших үед алдааs гарлаа!');      });  },  methods: {    check_token: functions.checkToken,    set_state: functions.setState,    get_entry: functions.getEntry,    get_uniq: functions.getUniq,    send_comment: functions.sendComment,    print: functions.print,    addTab: functions.addTab,    removeTab: functions.removeTab,    formatDate(date) {      return date.replace(/T/, ' ').replace(/\..+/, '');    },    async submitForm() {      this.states = [];      this.entries = [];      const nonEmptyElements = this.forms.filter((obj) => {        return obj;      });      nonEmptyElements.map((t) => this.get_entry(t, this.states, this.entries));      const body = {        id: this.$route.query.did,        task_stage_group: this.$route.query.tsg,        updated_user: this.$store.state.usr_id,        state: this.states,        data: this.entries,        ver_form: this.forms,        employee: this.$store.state.emp_id,      };      axios        .put(          this.$store.state.form_data_url + '?id=' + this.$route.query.did,          body        )        .then((response) => {          if (response.status === 200) {            alert('Амжилттай хадгалагдлаа!');          } else {            alert('Хадгалах үед алдаа гарлаа!');          }        })        .catch(() => {          alert('Хадгалах үед алдаа гарлаа!');        });    },    sendComment() {      this.send_comment(this.comments, this.comment_text);    },    set_entry(data) {      // this.$store.state.forms = JSON.parse(data.ver_form);      this.forms = data.ver_form;      this.states = data.state;      this.entries = data.data;      const nonEmptyElements = this.forms.filter((obj) => {        return obj;      });      nonEmptyElements.map((t) => this.setEntry(t, this.states, this.entries));    },    setEntry(t, states, entries) {      for (let i = 0; i < this.states.length; i++) {        if (t.switch.uniq === states[i].name) {          t.switch.entry = states[i].data;        }      }      for (let i = 0; i < entries.length; i++) {        for (let j = 0; j < t.fields.length; j++) {          if (t.fields[j].uniq === entries[i].name) {            if (t.fields[j].fieldType === 'TableComponent') {              const data = entries[i].data;              t.fields[j].tableColumns = data.tableColumns;              t.fields[j].tableDatas = data.tableDatas;            } else {              t.fields[j].entry = entries[i].data;            }          }        }      }    },  },};</script><style scoped>.border-bottom {  border-bottom: 1px dotted #ccc;}.comment div {  display: inline-block;  vertical-align: top;  margin-top: 10px;}.comment .avatar {  width: 5%;  text-align: center;}.comment .text {  width: 95%;}</style>