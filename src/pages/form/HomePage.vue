<template>  <div v-if="token !== null">    <el-container>      <el-main class="wrapper--forms" style="overflow-y: scroll; height: 100vh">        <el-form>          <el-row>            <el-button              style="margin-bottom: 10px"              type="primary"              @click="addSection"              >Бүлэг нэмэх            </el-button>          </el-row>          <el-row class="section-block" style="margin-bottom: 10px">            <el-col :span="19">              <el-form-item label="Бүлгийн нэр">                <el-input                  v-model="$store.state.form_name"                  @keyup="$store.state.form_name = $event.target.value"                ></el-input>              </el-form-item>            </el-col>            <el-col :span="5">              <el-form-item label="Бүлгийн код">                <el-input                  v-model="$store.state.form_code"                  @keyup="$store.state.form_code = $event.target.value"                ></el-input>              </el-form-item>            </el-col>          </el-row>          <template v-for="(eachFormObj, eachFormIndex) in forms">            <div :key="`div-${eachFormIndex}`" class="section-block">              <div class="source">                <el-row>                  <el-col :span="2">                    <el-input                      v-model="eachFormObj.code"                      placeholder="Код"                      style="width: 80%"                    ></el-input>                  </el-col>                  <el-col :span="15">                    <el-input                      v-model="eachFormObj.title"                      placeholder="Үйлдлийн нэр"                      style="width: 100%"                    ></el-input>                  </el-col>                  <el-col :span="5">                    <component                      :is="eachFormObj.switch.fieldType"                      style="padding-top: 0"                      :current-field="eachFormObj.switch"                      :v-model="eachFormObj.switch.entry"                      class="form__field"                    >                    </component>                  </el-col>                  <el-col :span="2" style="margin-top: 5px">                    <el-button                      type="danger"                      round                      style="float: right"                      @click="deleteSection(eachFormIndex, eachFormObj.title)"                      >Устгах                    </el-button>                  </el-col>                </el-row>              </div>              <div class="meta">                <el-row>                  <draggable                    :list="eachFormObj.fields"                    class="dragArea"                    :group="{ name: 'formbuilder', pull: false, put: true }"                    :sort="true"                    ghost-class="sortable__ghost"                  >                    <el-col                      v-for="(field, index) in eachFormObj.fields"                      :key="index"                      v-bind="field"                      :span="field.span"                      class="form__group"                      :class="{ 'is--active': field === activeField }"                    >                      <span class="form__selectedlabel">{{                        field.fieldType                      }}</span>                      <div @click="editElementProperties(field)">                        <component                          :is="field.fieldType"                          :current-field="field"                          class="form__field"                        >                        </component>                      </div>                      <!-- Actions list -->                      <div class="form__actiongroup">                        <el-button                          circle                          size="mini"                          icon="el-icon-rank"                          class="form__actionitem--move"                        ></el-button>                        <el-button-group class="form__actionlist">                          <el-button                            v-show="!field.isUnique"                            size="mini"                            icon="el-icon-plus"                            @click="                              cloneElement(index, field, eachFormObj.fields)                            "                          ></el-button>                          <el-button                            size="mini"                            icon="el-icon-delete"                            @click="deleteElement(index, eachFormObj.fields)"                          ></el-button>                        </el-button-group>                      </div>                    </el-col>                  </draggable>                </el-row>              </div>            </div>          </template>        </el-form>      </el-main>      <el-aside class="wrapper--sidebar">        <el-tabs v-model="activeTabForFields" type="border-card">          <el-tab-pane name="elements" label="Элементүүд">            <elements />          </el-tab-pane>          <el-tab-pane name="properties" label="Шинж чанар">            <properties              v-show="Object.keys($store.state.activeField).length > 0"              :active-field="activeField"            ></properties>          </el-tab-pane>        </el-tabs>        <el-card class="el-dialog--center">          <el-button type="primary" @click="submitForm()">Хадгалах</el-button>        </el-card>      </el-aside>    </el-container>  </div></template><script>import { FormBuilder } from '@/components/form_elements/formbuilder';import functions from '@/plugins/formFunctions';import axios from 'axios';export default {  name: 'Home',  components: FormBuilder.$options.components,  data() {    return {      token: this.$store.getters.token,      sortElementOptions: FormBuilder.$data.sortElementOptions,      forms: [],      activeField: this.$store.state.activeField,      activeTabForFields: this.$store.state.activeTabForFields,    };  },  async beforeMount() {    axios      .get(this.$store.state.form_stg_url + '?id=' + this.$route.query.stg_grp)      .then((data) => {        this.set_stage(data.data, 'HomeEntry');        this.forms = this.$store.state.forms;      })      .catch((error) => {        console.error('Error : ', error);        alert('Унших үед алдааs гарлаа!');      });  },  methods: {    check_token: functions.checkToken,    get_uniq: functions.getUniq,    set_stage: functions.setStage,    addSection: functions.addSection,    deleteSection: functions.deleteSection,    deleteElement(index, form) {      FormBuilder.deleteElement(index, form);    },    cloneElement(index, field, form) {      FormBuilder.cloneElement(index, field, form);    },    editElementProperties(field) {      FormBuilder.editElementProperties(field);      this.activeField = this.$store.state.activeField;    },    async submitForm() {      if (this.form_name === '' || this.form_code === '') {        this.$message.warning('Бүлгийн нэр эсвэл код оруулна уу!');        return false;      }      if (this.forms.length === 0) {        this.$message.warning('Маягт үүсгэнэ үү!');        return false;      }      const verForm = JSON.parse(JSON.stringify(this.forms));      for (let i = 0; i < verForm.length; i++) {        const flds = verForm[i].fields;        const uuniq = this.get_uniq();        verForm[i].activeTab = uuniq;        verForm[i].fields = [          {            uniq: uuniq,            del_able: false,            title: 'Хувилбар 1',            fields: flds,          },        ];      }      const body = {        group: this.$route.query.grp,        organization: this.$route.query.org,        algorithm: this.$route.query.alg,        stage_group: this.$route.query.stg_grp,        created_user: this.$route.query.usr,        name: this.$store.state.form_name,        code: this.$store.state.form_code,        form: this.forms,        ver_form: verForm,      };      axios        .post(this.$store.state.form_url, body)        .then((response) => {          if (response.status === 200) {            alert('Амжилттай хадгалагдлаа!');          } else {            console.error('Response : ' + response);            alert('Хадгалах үед алдаа гарлаа!');          }        })        .catch((error) => {          console.error('Error : ', error);          alert('Хадгалах үед алдаа гарлаа!');        });    },  },};</script>