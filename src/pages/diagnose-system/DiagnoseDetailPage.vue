<template>  <MainLayout>    <SubMenu>      <template #submenu>        <DiagnoseSideMenu @diagnose="getDiagnoseDetail" />      </template>    </SubMenu>    <NavBar>      <template #top>        <h5 class="p-3">Diagnose</h5>      </template>    </NavBar>    <div class="bg-light rounded p-4">      <div class="row">        <div class="col-md-0">          <b-avatar size="121px"></b-avatar>        </div>        <div class="col">          <h3 class="font-weight-bold mt-1 pr-2" style="color: #4276d0">            {{ diagnoseData.employee | get_employee_info }}          </h3>          <div class="d-flex">            <small class="font-weight pr-2">Diagnose Status:</small>            {{ diagnoseData.state }}            <small class="font-weight pr-2">              <b-badge                v-if="diagnoseData.state === 'confirm'"                variant="success"                class="text-white"              >                Confirm              </b-badge>              <b-badge                v-if="diagnoseData.state === 'sent'"                variant="warning"                class="text-white"              >                Sent              </b-badge>              <b-badge v-else variant="alert" class="text-white">                Draft              </b-badge>            </small>          </div>          <small class="font-weight pr-2">{{ diagnoseData.code }}</small>        </div>        <div class="col">          <div class="d-flex align-items-center">            <p class="text-black-50 mt-1 pr-2">Symptom:</p>            <p class="font-weight-bold mt-1 pr-2">              {{ diagnoseData.symptom_type | get_key_info_category }}            </p>          </div>          <div class="d-flex align-items-center">            <p class="text-black-50 mt-1 pr-2">Manager:</p>            <p class="font-weight-bold mt-1 pr-2">              {{ diagnoseData.manager | get_employee_info }}            </p>          </div>          <div class="d-flex align-items-center">            <p class="text-black-50 mt-1 pr-2">Primary Violated Duty:</p>            <p class="font-weight-bold mt-1 pr-2">              <!--              {{ diagnoseData.primary_breached_duty | get_duty_full_info }}-->              {{ primaryBreachedDuty }}            </p>          </div>        </div>        <div class="col">          <div class="d-flex align-items-center">            <p class="text-black-50 mt-1 pr-2">Identified Date:</p>            <p class="font-weight-bold mt-1 pr-2 right">              {{ diagnoseData.breached_date | date }}            </p>          </div>          <div class="b-inline-block">            <b-button variant="link"> Previous Diagnosis History </b-button>          </div>          <div class="b-inline-block">            <b-button variant="link"> Key Information Link </b-button>          </div>        </div>      </div>      <div class="diagnoseTab">        <b-tabs>          <b-tab title="Task Information" @click="tabIndex = 0" v-if="taskId">            <template #title>              <i class="bx bx-briefcase align-middle mr-1"></i>Task Information            </template>            <b-col cols="12"><TaskInformationTab :taskId="taskId" /></b-col>          </b-tab>          <b-tab title="Task Configuration" v-if="taskConfigurationId">            <template #title>              <i class="diagnoseTab bx bx-grid-alt align-middle mr-1"></i>Task              Configuration            </template>            <TaskConfigurationTab :taskConfId="taskConfigurationId" />          </b-tab>          <b-tab title="Algorithm Diagnosis">            <template #title>              <i class="bx bx-folder-open align-middle mr-1"></i>Algorithm              Diagnose            </template>            <DiagnoseAlgorithmTab              :diagnose_lines="diagnoseData.diagnose_line"            />          </b-tab>          <!--          <b-tab title="Bylaw Diagnosis">-->          <!--            <template #title>-->          <!--              <i class="bx bx-folder-open align-middle mr-1"></i>Bylaw Diagnosis-->          <!--            </template>-->          <!--          </b-tab>-->          <b-tab title="Summary" lazy>            <template #title>              <i class="bx bx-grid-alt align-middle mr-1"></i>Summary            </template>          </b-tab>        </b-tabs>      </div>    </div>  </MainLayout></template><script>import axios from 'axios';import NavBar from '@/components/layout/NavBar';import SubMenu from '@/components/layout/SubMenu';import MainLayout from '@/components/layout/MainLayout';import TaskInformationTab from '@/components/diagnose-system/diagnose_detail/TaskInformationTab';import TaskConfigurationTab from '@/components/diagnose-system/diagnose_detail/TaskConfigurationTab';import DiagnoseAlgorithmTab from '@/components/diagnose-system/diagnose_detail/DiagnoseAlgorithmTab';import DiagnoseSideMenu from '@/components/diagnose-system/diagnose_detail/DiagnoseSideMenu';export default {  name: 'DiagnoseDetailPage',  components: {    DiagnoseAlgorithmTab,    TaskInformationTab,    TaskConfigurationTab,    MainLayout,    NavBar,    DiagnoseSideMenu,    SubMenu,  },  validate({ params }) {    return /^\d+$/.test(params.id);  },  layout: 'main',  data() {    return {      tabIndex: 0,      diagnoseId: this.$route.params.id,      diagnoseData: null,      ready: false,      taskId: null,      taskConfigurationId: null,      diagnose_line: null,      primaryBreachedDuty: null,      problems: [],      system_problems: [],      diagnoseItems: [        {          name: 'Diagnosis',        },      ],    };  },  mounted() {    this.getDiagnoseDetail();  },  methods: {    emitProblemData(data) {      const dailyCheckData = this.$store.getters['dailyCheckData'];      const problems = data.problemData;      const systemProblem = data.systemProblem;      const dailyCheckId = data.dailycheck_id;      dailyCheckData.problems = problems;      dailyCheckData.system_problems = systemProblem;      dailyCheckData.dailycheck_id = dailyCheckId;      this.problems = problems;      this.$store.dispatch('dailyCheckData', dailyCheckData);    },    back() {      window.history.back();    },    async getDiagnoseDetail() {      let diagnose_id = this.$route.query.id;      if (!diagnose_id) {        diagnose_id = this.diagnoseId;      }      if (diagnose_id) {        const newUrl = `/pages/diag/view_diagnose/${diagnose_id}/`;        await axios          .get(newUrl)          .then((response) => {            this.diagnoseData = response.data.data;            this.taskConfigurationId =              this.diagnoseData.coordination_from_checklist;            this.taskId = this.diagnoseData.task;            this.getDuty();          })          .catch(() => {            document.location.history.back();          });      }    },    async getDuty() {      if (this.diagnoseData) {        if (this.diagnoseData.primary_breached_duty) {          let primary_breached_duty_id =            this.diagnoseData.primary_breached_duty;          const newUrl = `/api/duty/${primary_breached_duty_id}/`;          await axios            .get(newUrl)            .then((response) => {              this.primaryBreachedDuty =                response.data.regulation.short_name +                ' - ' +                response.data.code +                ' - ' +                response.data.name;            })            .catch(() => {              document.location.history.back();            });        } else {          this.primaryBreachedDuty = '';        }        console.log('diagnoseData', this.diagnoseData);      }    },  },  metaInfo: {    title: 'Diagnose Management | TUSS D+',  },};</script>